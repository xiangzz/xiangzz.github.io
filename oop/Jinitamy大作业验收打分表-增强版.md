# Jinitamy Web框架大作业验收打分表（代码问答版）

> **说明**：本验收打分表以代码问答为主，通过功能检测和代码问答题两部分，全面评估学生对代码的理解程度和实现质量。总分100分。

## 基本信息

| 学号 | 姓名 | 日期 | 验收人 |
|------|------|------|--------|
|  |  |  |  |

---

## 一、提交物完整性检查（前置条件，不通过则不予验收）

| 检查项 | 通过/不通过 | 备注 |
|--------|-------------|------|
| 源代码能编译（Maven构建成功） | ☐ 通过 ☐ 不通过 | `mvn compile` 无错误 |
| 项目结构符合要求（router/context/handler/engine/template分包） | ☐ 通过 ☐ 不通过 |  |
| 设计文档完整（UML类图、架构说明） | ☐ 通过 ☐ 不通过 |  |
| 用户手册完整（启动说明、API文档） | ☐ 通过 ☐ 不通过 |  |
| 测试文档完整（单元测试代码、curl测试脚本） | ☐ 通过 ☐ 不通过 |  |
| 提交时间符合要求 | ☐ 通过 ☐ 不通过 |  |

**判定**: _____ 全部通过方可进入功能验收

---

## 二、功能检测表格（60分）

> **评分说明**：本部分通过代码检查和功能测试，验证各核心功能的实现质量。按重要性分配分值。

### Part 3: HTTP Handler与责任链（12分）

| 评分项 | 分值 | 得分 | 检查方式 |
|--------|------|------|----------|
| Handler接口：正确定义handle(Context)方法 | 2 |  | 查看接口定义 |
| 责任链结构：每个Handler有next字段指向下一个Handler | 3 |  | 查看Handler类结构 |
| 责任链执行：能按顺序传递Context对象 | 3 |  | 查看handle方法实现 |
| **核心难点**：反向包装（最后一个Handler包装第一个） | 4 |  | 查看中间件添加代码 |
| **小计** | **12** |  |  |

**关键检查点**：
- [ ] Handler接口是否有`void handle(Context ctx)`方法
- [ ] 责任链是否使用单向链表结构（next字段）
- [ ] 中间件是否调用`next.handle(ctx)`传递Context
- [ ] 添加中间件时是否使用**倒序遍历**（反向包装）

---

### Part 4: Engine核心引擎（12分）

| 评分项 | 分值 | 得分 | 检查方式 |
|--------|------|------|----------|
| Netty集成：正确配置EventLoopGroup（bossGroup和workerGroup） | 3 |  | 查看服务器启动代码 |
| Netty集成：正确配置ServerBootstrap | 3 |  | 查看Bootstrap配置 |
| Pipeline配置：顺序添加HttpServerCodec、自定义Handler | 4 |  | 查看Pipeline初始化 |
| 启动与关闭：能成功bind端口，支持优雅关闭 | 2 |  | 查看启动和关闭方法 |
| **小计** | **12** |  |  |

**关键检查点**：
- [ ] 是否创建了两个EventLoopGroup（bossGroup接收连接，workerGroup处理IO）
- [ ] ServerBootstrap是否配置了group()、channel()、childHandler()等参数
- [ ] Pipeline中Handler的顺序是否正确（先HttpServerCodec，后自定义Handler）
- [ ] 是否实现了`shutdownGracefully()`优雅关闭

---

### Part 1: Router路由器（10分）

| 评分项 | 分值 | 得分 | 检查方式 |
|--------|------|------|----------|
| 路由数据结构：使用Trie树存储路由 | 3 |  | 查看Router类实现 |
| 路径参数提取：支持`/user/:id`风格的路径参数 | 3 |  | 查看Trie树节点定义 |
| 路由匹配：精确匹配（如`/user/login`） | 1 |  | 测试或查看代码 |
| 路由匹配：通配符匹配（如`/static/*`） | 1 |  | 测试或查看代码 |
| 路由匹配：路径参数提取（如`/user/123` → id=123） | 2 |  | 测试或查看代码 |
| **小计** | **10** |  |  |

**关键检查点**：
- [ ] 是否使用Trie树（或前缀树）数据结构存储路由
- [ ] Trie树节点是否有children字段（Map<String, Node>）
- [ ] 是否支持路径参数占位符（如`:id`、`:name`）
- [ ] 路由匹配时是否正确提取路径参数并存入Context

---

### Part 5: Template Engine模板引擎（8分）

| 评分项 | 分值 | 得分 | 检查方式 |
|--------|------|------|----------|
| FreeMarker配置：正确创建Configuration对象 | 2 |  | 查看模板引擎类 |
| 模板加载：设置模板加载路径（如`templates/`） | 2 |  | 查看Configuration配置 |
| 模板渲染：实现render(template, data)方法 | 4 |  | 查看渲染方法实现 |
| **小计** | **8** |  |  |

**关键检查点**：
- [ ] Configuration是否设置了模板版本（如`Configuration.VERSION_2_3_32`）
- [ ] 是否设置了模板目录（`setDirectoryForTemplateLoading`）
- [ ] render方法是否正确获取Template并处理数据绑定
- [ ] 渲染结果是否正确写入HttpResponse

---

### Part 2: Context上下文管理（6分）

| 评分项 | 分值 | 得分 | 检查方式 |
|--------|------|------|----------|
| 请求存储：正确存储HttpRequest对象 | 1 |  | 查看Context类 |
| 响应存储：正确存储HttpResponse对象 | 1 |  | 查看Context类 |
| 属性管理：实现set/get/remove方法 | 2 |  | 查看属性管理方法 |
| 路径参数：能从Router获取路径参数（如`ctx.param("id")`） | 2 |  | 查看param方法 |
| **小计** | **6** |  |  |

**关键检查点**：
- [ ] Context是否包含Request和Response字段
- [ ] 属性存储是否使用Map（建议ConcurrentHashMap保证线程安全）
- [ ] 是否提供`param(String key)`方法获取路径参数
- [ ] 参数是否由Router在匹配时存入Context

---

### Final Project: 博客站应用（8分）

| 评分项 | 分值 | 得分 | 检查方式 |
|--------|------|------|----------|
| 文章列表：GET /posts 返回所有文章 | 1 |  | 测试或查看代码 |
| 文章详情：GET /posts/:id 返回单篇文章 | 1 |  | 测试或查看代码 |
| 文章创建：POST /posts 创建新文章 | 1 |  | 测试或查看代码 |
| 文章编辑：PUT /posts/:id 更新文章 | 1 |  | 测试或查看代码 |
| 文章删除：DELETE /posts/:id 删除文章 | 1 |  | 测试或查看代码 |
| 模板渲染：能将文章数据渲染为HTML页面 | 3 |  | 查看渲染代码 |
| **小计** | **8** |  |  |

**关键检查点**：
- [ ] 是否实现了完整的CRUD功能
- [ ] 路由定义是否正确（HTTP方法、路径）
- [ ] Handler是否正确调用Context获取请求参数
- [ ] 模板渲染是否正确传递数据

---

### 代码质量与文档（4分）

| 评分项 | 分值 | 得分 | 检查方式 |
|--------|------|------|----------|
| 命名规范：类名使用PascalCase，方法名使用camelCase | 1 |  | 查看代码 |
| 代码格式：缩进统一，大括号位置一致 | 1 |  | 查看代码 |
| 文档完整性：UML类图完整（Router、Handler、Engine等） | 1 |  | 查看设计文档 |
| 文档完整性：责任链时序图完整 | 1 |  | 查看设计文档 |
| **小计** | **4** |  |  |

**关键检查点**：
- [ ] 类名、方法名、变量名是否符合Java命名规范
- [ ] 代码缩进是否统一（4空格或Tab）
- [ ] UML类图是否包含核心类（Router、Context、Handler、Engine等）
- [ ] 时序图是否展示责任链执行流程

---

**功能检测总分**: ______ / 60

---

## 三、代码问答题（40分）

> **说明**：本部分通过代码定位题，验证学生是否熟悉自己编写的代码。学生需要现场找到代码位置并解释实现逻辑。

### Part 1: Router路由器（6分）

| 题目 | 分值 | 得分 | 验收记录 |
|------|------|------|----------|
| **题1**: 请找到Trie树节点的数据结构定义，解释children字段的作用 | 3 |  | 代码位置: _____ 文件:_____ 行:_____ <br> 解释: ________________________________ |
| **题2**: 请找到路由匹配的核心算法代码，解释如何处理路径参数（如`/user/:id`） | 3 |  | 代码位置: _____ 文件:_____ 行:_____ <br> 解释: ________________________________ |
| **小计** | **6** |  |  |

**评分标准**：
- **3分**: 10秒内找到代码，解释准确完整
- **2分**: 20秒内找到代码，解释基本正确
- **1分**: 30秒内找到代码，解释模糊
- **0分**: 超过30秒或完全不会

---

### Part 2: Context上下文管理（6分）

| 题目 | 分值 | 得分 | 验收记录 |
|------|------|------|----------|
| **题3**: 请找到Context类的属性存储代码，解释用什么数据结构存储属性 | 3 |  | 代码位置: _____ 文件:_____ 行:_____ <br> 数据结构: ________________________________ |
| **题4**: 请找到路径参数获取的代码（param方法），解释参数如何从Router传递到Context | 3 |  | 代码位置: _____ 文件:_____ 行:_____ <br> 解释: ________________________________ |
| **小计** | **6** |  |  |

---

### Part 3: HTTP Handler与责任链（7分）

| 题目 | 分值 | 得分 | 验收记录 |
|------|------|------|----------|
| **题5**: 请找到责任链反向包装的代码，解释为什么要"反向"（最后一个包装第一个） | 4 |  | 代码位置: _____ 文件:_____ 行:_____ <br> 解释: ________________________________ |
| **题6**: 请找到中间件的代码（如日志中间件），解释如何实现请求/响应的日志记录 | 3 |  | 代码位置: _____ 文件:_____ 行:_____ <br> 解释: ________________________________ |
| **小计** | **7** |  |  |

**题5关键点**：
- 反向包装的原因：确保中间件按添加顺序执行（第一个添加的中间件最先处理请求）
- 例如：中间件A → 中间件B → 业务Handler，包装后形成 A.handle( B.handle( 业务Handler ) )

---

### Part 4: Engine核心引擎（7分）

| 题目 | 分值 | 得分 | 验收记录 |
|------|------|------|----------|
| **题7**: 请找到Pipeline配置的代码，解释Handler的添加顺序及其原因 | 4 |  | 代码位置: _____ 文件:_____ 行:_____ <br> 解释: ________________________________ |
| **题8**: 请找到自定义ChannelHandler的代码，解释如何将Netty的HttpRequest转换为Context对象 | 3 |  | 代码位置: _____ 文件:_____ 行:_____ <br> 解释: ________________________________ |
| **小计** | **7** |  |  |

**题7关键点**：
- Pipeline顺序：HttpServerCodec（解码） → 自定义Handler（业务处理）
- 原因：必须先将HTTP字节流解码为HttpRequest对象，后续Handler才能处理

---

### Part 5: Template Engine模板引擎（6分）

| 题目 | 分值 | 得分 | 验收记录 |
|------|------|------|----------|
| **题9**: 请找到FreeMarker Configuration的配置代码，解释版本设置的必要性 | 3 |  | 代码位置: _____ 文件:_____ 行:_____ <br> 解释: ________________________________ |
| **题10**: 请找到模板渲染的代码，解释如何将Java对象的数据传递给模板 | 3 |  | 代码位置: _____ 文件:_____ 行:_____ <br> 解释: ________________________________ |
| **小计** | **6** |  |  |

---

### Final Project: 博客站应用（8分）

| 题目 | 分值 | 得分 | 验收记录 |
|------|------|------|----------|
| **题11**: 请找到文章列表的路由定义，展示Handler如何处理请求并返回数据 | 4 |  | 代码位置: _____ 文件:_____ 行:_____ <br> 解释: ________________________________ |
| **题12**: 请找到创建文章的代码，解释如何解析请求体中的JSON数据 | 4 |  | 代码位置: _____ 文件:_____ 行:_____ <br> 解释: ________________________________ |
| **小计** | **8** |  |  |

---

**代码问答题总分**: ______ / 40

---

## 四、评分汇总

| 项目 | 分值 | 得分 | 占比 |
|------|------|------|------|
| **功能检测表格** | **60** |  | 60% |
| **代码问答题** | **40** |  | 40% |
| **总分** | **100** |  | 100% |

### 等级评定

| 分数范围 | 等级 | 抄袭风险判断 |
|---------|------|-------------|
| 90-100分 | ☐ 优秀 (A) | 低 - 代码问答题答得好 |
| 80-89分 | ☐ 良好 (B) | 低 - 代码问答题答得好 |
| 70-79分 | ☐ 中等 (C) | 中 - 需结合代码问答题判断 |
| 60-69分 | ☐ 及格 (D) | 高 - 代码问答题得分低 |
| <60分 | ☐ 不及格 (F) | 极高 - 功能和问答都差 |

**最终等级**: ___________

**抄袭风险评估**: ☐ 低 ☐ 中 ☐ 高

**评估依据**:
- 功能检测分高但代码问答分低 = 高度怀疑抄袭
- 代码问答题反应时间（<10秒=正常，>30秒=可疑）
- 代码解释准确性（能解释原理=自己完成，只会读代码=可能抄袭）

---

## 五、验收意见

### 优点：
1.
2.
3.

### 需要改进的地方：
1.
2.
3.

### 代码熟悉度评估：
- 能快速定位代码（10秒内）: ☐ 是 ☐ 否
- 能准确解释代码逻辑: ☐ 是 ☐ 否
- 能回答深层原因（如反向包装原理）: ☐ 是 ☐ 否
- **综合判断**: ☐ 自己完成 ☐ 参考完成 ☐ 高度抄袭

### 其他备注：


---

## 六、验收人签字

**验收人**: ____________________
**日期**: ____________________
**学生签字**: ____________________ (可选)

---

## 七、代码问答题评分标准参考

| 评分等级 | 定位速度 | 解释质量 | 得分比例 | 抄袭风险 |
|---------|---------|---------|---------|---------|
| 优秀 | <10秒 | 准确完整，能解释设计原因 | 100% | 无 |
| 良好 | <20秒 | 准确，但解释不够深入 | 80% | 低 |
| 一般 | <30秒 | 基本正确，有些细节不清 | 60% | 中 |
| 困难 | >30秒 | 找到了但解释不清 | 40% | 高 |
| 不会 | 找不到 | 完全不会解释 | 0% | 极高 |

### 使用建议

1. **快速验收模式**（5分钟/组）:
   - 从功能检测中选择重点Part（Part 3和Part 4）
   - 从代码问答题中选择2道核心题（题5反向包装 + 题7 Pipeline配置）
   - 总时间控制在5分钟内

2. **标准验收模式**（10分钟/组）:
   - 完整检查功能检测表格的所有Part
   - 每个Part选择1道代码问答题，共6道题
   - 总分100分，时间控制在10分钟内

3. **深度验收模式**（15分钟/组）:
   - 完整检查功能检测表格
   - 所有代码问答题（12道题）全部提问
   - 加上追问和现场修改测试
   - 时间15分钟，适合最终评奖

4. **防抄袭策略**:
   - **反向包装原理**: 这是核心难点，如果学生能清楚解释为什么要反向包装，基本可以排除抄袭
   - **Netty概念追问**: "EventLoopGroup的线程数如何设置？为什么需要两个Group？"
   - **现场修改**: "请把日志中间件的输出格式改成JSON，需要修改哪些代码？"
   - **代码一致性检查**: 如果多个学生代码完全一致（包括变量名、注释、格式），且代码问答题答得差，可判定为抄袭

---

## 附录：验收测试脚本

### 功能检测测试

```bash
# 1. 启动服务器（假设端口8080）
java -jar target/jinitamy.jar

# 2. 测试Router - 路由匹配
curl http://localhost:8080/posts                    # 文章列表
curl http://localhost:8080/posts/123                # 文章详情（路径参数）
curl -X POST http://localhost:8080/posts \
  -H "Content-Type: application/json" \
  -d '{"title":"Test Post","content":"This is a test"}'

# 3. 测试Context - 请求处理
curl http://localhost:8080/test/param?id=123        # 测试参数获取

# 4. 测试Handler - 责任链中间件
# 观察日志输出，验证中间件是否按顺序执行
# 预期输出：
# [日志中间件] 请求进入: GET /posts
# [权限中间件] 检查权限
# [业务Handler] 处理请求
# [权限中间件] 响应返回
# [日志中间件] 响应返回: 200 OK

# 5. 测试Engine - 并发处理
ab -n 1000 -c 10 http://localhost:8080/posts       # Apache Bench压力测试
# 观察服务器是否稳定，有无线程泄漏

# 6. 测试Template - 模板渲染
curl http://localhost:8080/                        # 首页HTML渲染
# 检查响应是否包含HTML内容（Content-Type: text/html）
```

---

## 附录：常见问题清单

### 功能性问题
1. **路由不匹配**: 检查Trie树的插入和查找逻辑，路径是否正确拆分
2. **路径参数获取不到**: 检查Router是否正确提取参数并存入Context
3. **责任链不执行**: 检查是否正确调用next.handle(ctx)
4. **反向包装错误**: 检查添加中间件的循环顺序，应该是倒序遍历
5. **Netty Handler顺序错误**: Pipeline中应该先添加HttpServerCodec，再添加自定义Handler
6. **模板渲染失败**: 检查模板文件路径是否正确，数据模型是否匹配

### 设计问题
1. **使用ArrayList存储路由**: 查找复杂度O(n)，应该用Trie树
2. **Context使用Map存储属性**: 应该考虑线程安全，建议使用ConcurrentHashMap
3. **中间件不调用next**: 导致责任链中断，后续Handler无法执行
4. **Pipeline配置顺序错误**: 导致业务Handler无法正确处理请求
5. **模板引擎每次都创建Configuration**: 性能差，应该单例模式

### 性能问题
1. **Trie树实现低效**: 每次匹配都创建新对象，应该重用对象
2. **责任链传递Context时复制**: 应该传递同一个Context对象
3. **模板每次都从磁盘加载**: 应该使用FreeMarker的缓存机制
4. **Netty线程池配置不当**: bossGroup和workerGroup线程数设置不合理

### 代码质量问题
1. **命名不规范**: 类名使用PascalCase，方法名使用camelCase
2. **过度使用static**: 大量静态方法，不是面向对象设计
3. **硬编码**: 端口号、路径等写成魔法数字
4. **资源泄漏**: Socket或Channel没有正确关闭

---

## 附录：代码问答题参考答案（供验收人参考）

### 题1: Trie树节点的children字段
**参考答案**:
- children是Map<String, TrieNode>类型，存储子节点
- key是路径段（如"user"、"posts"），value是下一个TrieNode
- 作用：实现O(1)复杂度的子节点查找，支持快速路由匹配

### 题2: 路径参数处理
**参考答案**:
- 遍历路径时，如果遇到`:`开头的段（如`:id`），识别为参数占位符
- 将实际路径中的对应段存入params Map
- 例如：`/user/123`匹配`/user/:id`，params={"id": "123"}

### 题5: 反向包装原理
**参考答案**:
- 反向包装是为了保证中间件按添加顺序执行
- 假设添加顺序：日志中间件 → 权限中间件 → 业务Handler
- 反向包装后：日志Handler(权限Handler(业务Handler))
- 执行时：日志先执行（请求前），权限中间处理，业务逻辑最后执行
- 响应时反向返回：业务 → 权限 → 日志

### 题7: Pipeline顺序
**参考答案**:
- 顺序：HttpServerCodec → 自定义业务Handler
- 原因：HttpServerCodec负责将字节流解码为HttpRequest对象
- 必须先解码，后续Handler才能处理HTTP请求对象

---

**使用说明**:
1. 本表格适用于代码问答为主的验收方式，强调学生对代码的理解程度
2. 代码问答题需要学生现场找到代码并解释，防止抄袭
3. 验收人可以根据时间灵活调整题目数量
4. 复选框 ☐ 可用鼠标点击勾选（在支持的Markdown编辑器中）

**文档版本**: v2.0 - 代码问答版
**最后更新**: 2025年
**适用课程**: 面向对象程序设计（Java）- Web框架大作业
