# Jinitamy Web框架大作业验收打分表（增强版 - 含代码定位检查）

## 基本信息

| 学号 | 姓名 | 日期 | 验收人 |
|------|------|------|--------|
|  |  |  |  |

---

## 一、提交物完整性检查（前置条件，不通过则不予验收）

| 检查项 | 通过/不通过 | 备注 |
|--------|-------------|------|
| 源代码能编译（Maven构建成功） | ☐ 通过 ☐ 不通过 | `mvn compile` 无错误 |
| 项目结构符合要求（router/context/handler/engine/template分包） | ☐ 通过 ☐ 不通过 |  |
| 设计文档完整（UML类图、架构说明） | ☐ 通过 ☐ 不通过 |  |
| 用户手册完整（启动说明、API文档） | ☐ 通过 ☐ 不通过 |  |
| 测试文档完整（单元测试代码、curl测试脚本） | ☐ 通过 ☐ 不通过 |  |
| 提交时间符合要求 | ☐ 通过 ☐ 不通过 |  |

**判定**: _____ 全部通过方可进入功能验收

---

## 二、功能评分 + 代码定位检查（95分）

> **说明**：每个Part包含功能评分和代码定位题，代码定位题用于验证学生是否熟悉自己编写的代码，防止抄袭。

### Part 1: Router 路由器（15分 + 代码定位3分）

#### 功能评分（15分）

| 评分项 | 分值 | 得分 | 备注 |
|--------|------|------|------|
| 路由数据结构：使用Trie树存储路由 | 3 |  |  |
| 路由数据结构：支持路径参数提取（如`/user/:id`） | 3 |  |  |
| 路由匹配：精确匹配（`/user/login`） | 2 |  |  |
| 路由匹配：通配符匹配（`/static/*`） | 2 |  |  |
| 路由匹配：路径参数提取（`/user/123` → id=123） | 3 |  |  |
| HTTP方法支持：GET、POST、PUT、DELETE | 2 |  |  |
| **功能小计** | **15** |  |  |

#### 代码定位题（3分）- 随机抽取1题

| 题目 | 抽中 | 得分 | 验收记录 |
|------|------|------|----------|
| **题1**: 请找到Trie树节点的数据结构定义，解释children字段的作用 | ☐ |  | 位置:_____<br>解释:_____ |
| **题2**: 请找到路由匹配的核心算法代码，解释如何处理路径参数 | ☐ |  | 位置:_____<br>解释:_____ |
| **题3**: 请找到添加路由的代码，解释如何将路径拆分存入Trie树 | ☐ |  | 位置:_____<br>解释:_____ |
| **代码定位小计** | **3** |  |  |

**Part 1 总分**: ______ / 18

---

### Part 2: Context 上下文管理（10分 + 代码定位2分）

#### 功能评分（10分）

| 评分项 | 分值 | 得分 | 备注 |
|--------|------|------|------|
| 请求存储：正确存储HttpRequest对象 | 2 |  |  |
| 响应存储：正确存储HttpResponse对象 | 2 |  |  |
| 属性管理：set/get/remove方法正确实现 | 2 |  |  |
| 属性管理：支持线程安全的属性访问 | 2 |  |  |
| 路径参数：能从Router获取路径参数（如`ctx.param("id")`） | 2 |  |  |
| **功能小计** | **10** |  |  |

#### 代码定位题（2分）- 随机抽取1题

| 题目 | 抽中 | 得分 | 验收记录 |
|------|------|------|----------|
| **题4**: 请找到Context类的属性存储代码，解释用什么数据结构 | ☐ |  | 位置:_____<br>解释:_____ |
| **题5**: 请找到路径参数获取的代码，解释如何从Router传递参数 | ☐ |  | 位置:_____<br>解释:_____ |
| **代码定位小计** | **2** |  |  |

**Part 2 总分**: ______ / 12

---

### Part 3: HTTP Handler与责任链（20分 + 代码定位5分）

#### 功能评分（20分）

| 评分项 | 分值 | 得分 | 备注 |
|--------|------|------|------|
| Handler接口：定义handle(Context)方法 | 2 |  |  |
| 责任链结构：每个Handler有next指向下一个Handler | 3 |  |  |
| 责任链执行：能按顺序传递Context | 3 |  |  |
| **核心难点**：反向包装（最后一个包装第一个） | 5 |  |  |
| 中间件：实现至少2个中间件（如日志、权限） | 3 |  |  |
| 中间件：正确调用next.handle(ctx)传递 | 2 |  |  |
| 终止处理：某个Handler不调用next则终止责任链 | 2 |  |  |
| **功能小计** | **20** |  |  |

#### 代码定位题（5分）- 随机抽取1-2题

| 题目 | 抽中 | 得分 | 验收记录 |
|------|------|------|----------|
| **题6**: 请找到责任链反向包装的代码，解释为什么要反向 | ☐ |  | 位置:_____<br>解释:_____ |
| **题7**: 请找到中间件的代码，解释如何实现日志记录 | ☐ |  | 位置:_____<br>解释:_____ |
| **题8**: 请找责任链执行的入口代码，解释如何触发第一个Handler | ☐ |  | 位置:_____<br>解释:_____ |
| **代码定位小计** | **5** |  |  |

**Part 3 总分**: ______ / 25

---

### Part 4: Engine 核心引擎（20分 + 代码定位3分）

#### 功能评分（20分）

| 评分项 | 分值 | 得分 | 备注 |
|--------|------|------|------|
| Netty集成：正确配置EventLoopGroup | 3 |  |  |
| Netty集成：正确配置ServerBootstrap | 3 |  |  |
| Pipeline配置：顺序添加HttpServerCodec、自定义Handler | 5 |  |  |
| Pipeline配置：Handler顺序正确（先解码后业务） | 4 |  |  |
| 启动服务器：bind端口成功 | 3 |  |  |
| 优雅关闭：实现shutdownGracefully | 2 |  |  |
| **功能小计** | **20** |  |  |

#### 代码定位题（3分）- 随机抽取1题

| 题目 | 抽中 | 得分 | 验收记录 |
|------|------|------|----------|
| **题9**: 请找到Pipeline配置的代码，解释Handler的添加顺序 | ☐ |  | 位置:_____<br>解释:_____ |
| **题10**: 请找到自定义ChannelHandler的代码，解释如何将Netty请求转为Context | ☐ |  | 位置:_____<br>解释:_____ |
| **题11**: 请找到服务器启动的代码，解释bossGroup和workerGroup的区别 | ☐ |  | 位置:_____<br>解释:_____ |
| **代码定位小计** | **3** |  |  |

**Part 4 总分**: ______ / 23

---

### Part 5: Template Engine 模板引擎（15分 + 代码定位2分）

#### 功能评分（15分）

| 评分项 | 分值 | 得分 | 备注 |
|--------|------|------|------|
| FreeMarker配置：正确创建Configuration | 3 |  |  |
| 模板加载：设置模板加载路径（如`templates/`） | 3 |  |  |
| 模板渲染：实现render(template, data)方法 | 4 |  |  |
| 数据绑定：能将Java对象传递给模板 | 3 |  |  |
| 输出响应：将渲染结果写入HttpResponse | 2 |  |  |
| **功能小计** | **15** |  |  |

#### 代码定位题（2分）- 随机抽取1题

| 题目 | 抽中 | 得分 | 验收记录 |
|------|------|------|----------|
| **题12**: 请找到FreeMarker Configuration配置代码，解释版本设置 | ☐ |  | 位置:_____<br>解释:_____ |
| **题13**: 请找到模板渲染的代码，解释如何将数据传递给模板 | ☐ |  | 位置:_____<br>解释:_____ |
| **代码定位小计** | **2** |  |  |

**Part 5 总分**: ______ / 17

---

### Final Project: 博客站应用（15分 + 代码定位5分）

#### 功能评分（15分）

| 评分项 | 分值 | 得分 | 备注 |
|--------|------|------|------|
| 文章列表：GET /posts 返回所有文章 | 3 |  |  |
| 文章详情：GET /posts/:id 返回单篇文章 | 3 |  |  |
| 文章创建：POST /posts 创建新文章 | 3 |  |  |
| 文章编辑：PUT /posts/:id 更新文章 | 3 |  |  |
| 文章删除：DELETE /posts/:id 删除文章 | 3 |  |  |
| **功能小计** | **15** |  |  |

#### 代码定位题（5分）- 随机抽取2题

| 题目 | 抽中 | 得分 | 验收记录 |
|------|------|------|----------|
| **题14**: 请找到文章列表的路由定义，展示Handler如何处理 | ☐ |  | 位置:_____<br>解释:_____ |
| **题15**: 请找到创建文章的代码，解释如何解析请求体 | ☐ |  | 位置:_____<br>解释:_____ |
| **题16**: 请找到模板渲染的代码，说明如何将文章数据传给模板 | ☐ |  | 位置:_____<br>解释:_____ |
| **代码定位小计** | **5** |  |  |

**Final Project 总分**: ______ / 20

---

## 三、代码质量评分（10分）

| 评分项 | 分值 | 得分 | 备注 |
|--------|------|------|------|
| 命名规范：类名使用PascalCase | 1 |  |  |
| 命名规范：方法名和变量名使用camelCase | 1 |  |  |
| 代码格式：缩进统一，大括号位置一致 | 1 |  |  |
| 封装性：成员变量使用private | 2 |  |  |
| 单一职责：每个类职责明确 | 2 |  |  |
| 代码复用：避免重复代码 | 1 |  |  |
| 异常处理：捕获并处理Netty异常 | 2 |  |  |
| **小计** | **10** |  |  |

---

## 四、文档质量评分（5分）

| 评分项 | 分值 | 得分 | 备注 |
|--------|------|------|------|
| 设计文档：UML类图完整（Router、Handler、Engine等） | 1.5 |  |  |
| 设计文档：责任链时序图完整 | 1.5 |  |  |
| 用户手册：启动步骤清晰 | 1 |  |  |
| 测试文档：有curl测试脚本或单元测试 | 1 |  |  |
| **小计** | **5** |  |  |

---

## 五、综合代码追踪题（可选，5分）

> **说明**：此部分为进阶题，用于深度检查学生对代码的理解程度。

| 题目 | 抽中 | 得分 | 验收记录 |
|------|------|------|----------|
| **题17**: 追踪HTTP请求从进入到返回的完整路径，说明经过哪些类 | ☐ |  | 路径:<br>1._____<br>2._____<br>3._____ |
| **题18**: 请找到责任链反向包装的代码，用图示说明包装顺序 | ☐ |  | 图示:<br>_____ |
| **题19**: 请找到Netty的ChannelRead代码，解释如何触发业务Handler | ☐ |  | 位置:_____<br>解释:_____ |
| **题20**: 请找到模板渲染时数据绑定的代码，解释FreeMarker如何工作 | ☐ |  | 位置:_____<br>解释:_____ |
| **综合小计** | **5** |  |  |

---

## 六、扩展功能评分（最多20分）

| 扩展功能 | 难度系数 | 完成度(0-5) | 得分 = 完成度×系数 | 代码定位检查 |
|---------|---------|-------------|------------------|-------------|
| 静态文件服务（StaticFileHandler） | 1.0 |  |  | 请找到静态文件处理的代码:_____ |
| Session管理（Session中间件） | 1.5 |  |  | 请找到Session存储的代码:_____ |
| JSON自动序列化 | 1.2 |  |  | 请找到JSON转换的代码:_____ |
| 文件上传功能 | 1.3 |  |  | 请找文件上传解析的代码:_____ |
| 数据库集成（如MyBatis） | 1.5 |  |  | 请找到数据库访问的代码:_____ |
| 其他：_____________ |  |  |  |  |
| **小计** |  |  |  |  |

---

## 七、评分汇总

| 项目 | 分值 | 得分 |
|------|------|------|
| 功能评分（五个Part + Final Project） | 95 |  |
| 代码定位题（防抄袭检查） | 20 |  |
| 代码质量评分 | 10 |  |
| 文档质量评分 | 5 |  |
| 综合代码追踪题（可选） | 5 |  |
| 扩展功能评分 | 最多20 |  |
| **总分** | **135+20** |  |

### 等级评定

| 分数范围 | 等级 | 抄袭风险判断 |
|---------|------|-------------|
| 120-155分 | ☐ 优秀 (A) | 低 - 代码定位题答得好 |
| 105-119分 | ☐ 良好 (B) | 低 - 代码定位题答得好 |
| 90-104分 | ☐ 中等 (C) | 中 - 需结合代码定位题判断 |
| 75-89分 | ☐ 及格 (D) | 高 - 代码定位题得分低 |
| <75分 | ☐ 不及格 (F) | 极高 - 功能和代码定位都差 |

**最终等级**: ___________

**抄袭风险评估**: ☐ 低 ☐ 中 ☐ 高

---

## 八、验收意见

### 优点：
1.
2.
3.

### 需要改进的地方：
1.
2.
3.

### 代码熟悉度评估：
- 能快速定位代码（10秒内）: ☐ 是 ☐ 否
- 能准确解释代码逻辑: ☐ 是 ☐ 否
- 能回答深层原因（如反向包装原理）: ☐ 是 ☐ 否
- **综合判断**: ☐ 自己完成 ☐ 参考完成 ☐ 高度抄袭

### 其他备注：


---

## 九、验收人签字

**验收人**: ____________________
**日期**: ____________________
**学生签字**: ____________________ (可选)

---

## 十、代码定位题评分标准参考

| 评分等级 | 定位速度 | 解释质量 | 得分比例 | 抄袭风险 |
|---------|---------|---------|---------|---------|
| 优秀 | <10秒 | 准确完整，能解释设计原因 | 100% | 无 |
| 良好 | <20秒 | 准确，但解释不够深入 | 80% | 低 |
| 一般 | <30秒 | 基本正确，有些细节不清 | 60% | 中 |
| 困难 | >30秒 | 找到了但解释不清 | 40% | 高 |
| 不会 | 找不到 | 完全不会解释 | 0% | 极高 |

### 使用建议

1. **快速验收模式**（5分钟/组）:
   - 从Part 3和Part 4各选1道代码定位题
   - 例如：题6（反向包装）+ 题9（Pipeline配置）

2. **标准验收模式**（10分钟/组）:
   - 每个Part选1道代码定位题
   - 共6道题，总分20分

3. **深度验收模式**（15分钟/组）:
   - 每个Part选1道代码定位题
   - 加上综合追踪题（题17-20）
   - 共7-8道题，总分25分

4. **防抄袭策略**:
   - **反向包装原理**: 这是核心难点，如果学生能清楚解释为什么要反向包装，基本可以排除抄袭
   - **Netty概念追问**: "EventLoopGroup的线程数如何设置？为什么需要两个Group？"
   - **现场修改**: "请把日志中间件的输出格式改成JSON"
   - **代码一致性检查**: 如果多个学生代码完全一致（包括变量名、注释、格式），且代码定位题答得差，可判定为抄袭

---

## 附录：验收测试脚本

### Part 1-2 测试（Router + Context）

```bash
# 启动服务器（假设端口8080）
java -jar target/jinitamy.jar

# 测试路由匹配
curl http://localhost:8080/posts
curl http://localhost:8080/posts/123
curl -X POST http://localhost:8080/posts -H "Content-Type: application/json" -d '{"title":"Test"}'
```

### Part 3 测试（责任链）

```bash
# 观察日志输出，验证中间件是否按顺序执行
# 预期输出：
# [中间件1] 请求进入
# [中间件2] 请求进入
# [业务Handler] 处理请求
# [中间件2] 响应返回
# [中间件1] 响应返回
```

### Part 4 测试（Engine）

```bash
# 测试并发请求
ab -n 1000 -c 10 http://localhost:8080/posts

# 观察服务器是否稳定，有无线程泄漏
```

### Part 5 测试（模板引擎）

```bash
# 访问需要渲染的页面
curl http://localhost:8080/

# 检查响应是否包含HTML内容
```

---

## 附录：常见问题清单

### 功能性问题
1. **路由不匹配**: 检查Trie树的插入和查找逻辑，路径是否正确拆分
2. **路径参数获取不到**: 检查Router是否正确提取参数并存入Context
3. **责任链不执行**: 检查是否正确调用next.handle(ctx)
4. **反向包装错误**: 检查添加中间件的循环顺序，应该是倒序遍历
5. **Netty Handler顺序错误**: Pipeline中应该先添加HttpServerCodec，再添加自定义Handler

### 设计问题
1. **使用ArrayList存储路由**: 查找复杂度O(n)，应该用Trie树
2. **Context使用Map存储属性**: 应该考虑线程安全
3. **中间件不调用next**: 导致责任链中断
4. **Pipeline配置顺序错误**: 导致业务Handler无法正确处理请求
5. **模板引擎每次都创建Configuration**: 性能差，应该单例

### 性能问题
1. **Trie树实现低效**: 每次匹配都创建新对象
2. **责任链传递Context时复制**: 应该传递同一个Context对象
3. **模板每次都从磁盘加载**: 应该使用缓存
4. **Netty线程池配置不当**: bossGroup和workerGroup线程数设置不合理

---

**使用说明**:
1. 本表格融合了功能验收和代码定位检查
2. 代码定位题在每个Part的评分后，验收时可根据时间灵活选择
3. 所有代码定位题都是开放式的，需要学生现场找到代码并解释
4. 抄袭风险综合评估：功能分高但代码定位分低 = 高度怀疑抄袭
5. 复选框 ☐ 可用鼠标点击勾选（在支持的Markdown编辑器中）

**文档版本**: v1.0 - 增强版（含代码定位检查）
**最后更新**: 2025年
**适用课程**: 面向对象程序设计（Java）- Web框架大作业
