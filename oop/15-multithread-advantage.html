<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šçº¿ç¨‹åŸç†æ¼”ç¤ºï¼šä¸²è¡Œ vs å¹¶å‘ vs å¹¶è¡Œ</title>
    <link rel="stylesheet" href="./css/style.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .description {
            max-width: 1000px;
            text-align: left;
            margin-bottom: 20px;
            color: #555;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .desc-item h3 {
            margin-top: 0;
            color: #2980b9;
            font-size: 1.1rem;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 8px;
            margin-bottom: 10px;
        }
        
        .desc-item p {
            font-size: 0.9rem;
            line-height: 1.5;
            margin: 0;
        }

        .controls {
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            position: sticky;
            top: 20px;
            z-index: 100;
            background: rgba(240, 242, 245, 0.9);
            padding: 10px;
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }

        button {
            padding: 12px 30px;
            font-size: 1rem;
            cursor: pointer;
            background-color: #34495e;
            color: white;
            border: none;
            border-radius: 6px;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            font-weight: 600;
        }

        button:hover {
            background-color: #2c3e50;
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }

        button.primary {
            background-color: #3498db;
        }
        
        button.primary:hover {
            background-color: #2980b9;
        }

        .main-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            width: 100%;
            max-width: 1400px;
            padding: 0 20px;
        }

        .panel {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 20px;
            display: flex;
            flex-direction: column;
            border-top: 5px solid #bdc3c7;
        }

        .panel.serial { border-top-color: #e67e22; }
        .panel.concurrent { border-top-color: #f1c40f; }
        .panel.parallel { border-top-color: #27ae60; }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 15px;
        }

        .panel-title {
            font-size: 1.2rem;
            color: #2c3e50;
            font-weight: bold;
        }

        .status-badge {
            background: #e0e0e0;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            color: #555;
            font-family: monospace;
        }

        .status-badge.running {
            color: white;
            animation: pulse 1.5s infinite;
        }
        
        .serial .status-badge.running { background: #e67e22; }
        .concurrent .status-badge.running { background: #f1c40f; color: #333; }
        .parallel .status-badge.running { background: #27ae60; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .cpu-info {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 15px;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            border: 1px dashed #ccc;
        }

        .task-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .task-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            border-radius: 8px;
            background: #f9f9f9;
            transition: all 0.2s;
            border: 1px solid transparent;
            position: relative;
        }

        /* æ¿€æ´»çŠ¶æ€ */
        .task-row.active {
            background: #fff;
            border-color: #3498db;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.15);
            z-index: 1;
        }

        .task-icon {
            width: 36px;
            height: 36px;
            background: #bdc3c7;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 1rem;
            flex-shrink: 0;
            position: relative;
        }

        /* CPU æŒ‡é’ˆ */
        .cpu-cursor {
            position: absolute;
            left: -8px;
            top: 50%;
            transform: translateY(-50%);
            width: 0; 
            height: 0; 
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-left: 10px solid #e74c3c;
            opacity: 0;
            transition: opacity 0.1s;
        }
        
        .cpu-label {
            position: absolute;
            left: -45px;
            top: 50%;
            transform: translateY(-50%);
            background: #e74c3c;
            color: white;
            font-size: 0.6rem;
            padding: 2px 4px;
            border-radius: 3px;
            opacity: 0;
            transition: opacity 0.1s;
            white-space: nowrap;
        }

        .task-row.active .cpu-cursor,
        .task-row.active .cpu-label {
            opacity: 1;
        }

        .task-row.active .task-icon {
            background: #3498db;
        }
        
        .task-info {
            flex-grow: 1;
        }

        .task-name {
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
        }
        
        .task-status-text {
            font-size: 0.75rem;
            color: #7f8c8d;
            font-weight: normal;
        }

        .progress-track {
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: #3498db;
            border-radius: 5px;
            transition: width 0.1s linear;
        }
        
        .task-row.completed .progress-bar { background: #27ae60; }
        .task-row.completed .task-icon { background: #27ae60; }
        
        .total-time {
            margin-top: 15px;
            text-align: right;
            font-size: 0.9rem;
            font-weight: bold;
            color: #2c3e50;
            height: 20px;
        }

    </style>
</head>
<body>

    <h1>å¤šçº¿ç¨‹åŸç†æ¼”ç¤ºï¼šä¸²è¡Œ vs å¹¶å‘ vs å¹¶è¡Œ</h1>
    
    <div class="description">
        <div class="desc-item">
            <h3>å•çº¿ç¨‹ (ä¸²è¡Œ)</h3>
            <p><strong>1ä¸ª CPUï¼Œ1ä¸ªçº¿ç¨‹ã€‚</strong><br>ä»»åŠ¡å¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼Œå‰ä¸€ä¸ªä¸ç»“æŸï¼Œåä¸€ä¸ªç»ä¸å¼€å§‹ã€‚ç®€å•ä½†æ•ˆç‡ä½ï¼Œå®¹æ˜“é˜»å¡ã€‚</p>
        </div>
        <div class="desc-item">
            <h3>å•æ ¸å¹¶å‘ (Concurrency)</h3>
            <p><strong>1ä¸ª CPUï¼Œå¤šä¸ªçº¿ç¨‹ã€‚</strong><br>CPU åœ¨ä»»åŠ¡é—´å¿«é€Ÿåˆ‡æ¢ï¼ˆæ—¶é—´ç‰‡è½®è½¬ï¼‰ã€‚å¾®è§‚ä¸Šä¸€æ¬¡åªèƒ½åšä¸€ä¸ªï¼Œä½†å®è§‚ä¸Šåƒåœ¨åŒæ—¶åšã€‚è§£å†³äº†é˜»å¡é—®é¢˜ã€‚</p>
        </div>
        <div class="desc-item">
            <h3>å¤šæ ¸å¹¶è¡Œ (Parallelism)</h3>
            <p><strong>å¤šä¸ª CPUï¼Œå¤šä¸ªçº¿ç¨‹ã€‚</strong><br>çœŸæ­£çš„åŒæ—¶è¿è¡Œï¼ä¸åŒçš„ CPU æ ¸å¿ƒåŒæ—¶å¤„ç†ä¸åŒçš„ä»»åŠ¡ã€‚æ•ˆç‡æœ€é«˜ã€‚</p>
        </div>
    </div>

    <div class="controls">
        <button class="primary" onclick="startAll()">å¼€å§‹å¯¹æ¯”æ¼”ç¤º</button>
        <button onclick="resetAll()">é‡ç½®</button>
    </div>

    <div class="main-container">
        <!-- 1. ä¸²è¡Œ -->
        <div class="panel serial" id="panel-serial">
            <div class="panel-header">
                <span class="panel-title">å•çº¿ç¨‹ä¸²è¡Œ</span>
                <span class="status-badge" id="badge-serial">IDLE</span>
            </div>
            <div class="cpu-info">ğŸ–¥ï¸ CPU Core: 1</div>
            <div class="task-container" id="container-serial">
                <!-- JS ç”Ÿæˆä»»åŠ¡ -->
            </div>
            <div class="total-time" id="time-serial"></div>
        </div>

        <!-- 2. å¹¶å‘ -->
        <div class="panel concurrent" id="panel-concurrent">
            <div class="panel-header">
                <span class="panel-title">å•æ ¸å¹¶å‘ (æ—¶é—´ç‰‡)</span>
                <span class="status-badge" id="badge-concurrent">IDLE</span>
            </div>
            <div class="cpu-info">ğŸ–¥ï¸ CPU Core: 1 (Switching)</div>
            <div class="task-container" id="container-concurrent">
                <!-- JS ç”Ÿæˆä»»åŠ¡ -->
            </div>
            <div class="total-time" id="time-concurrent"></div>
        </div>

        <!-- 3. å¹¶è¡Œ -->
        <div class="panel parallel" id="panel-parallel">
            <div class="panel-header">
                <span class="panel-title">å¤šæ ¸å¹¶è¡Œ</span>
                <span class="status-badge" id="badge-parallel">IDLE</span>
            </div>
            <div class="cpu-info">ğŸ–¥ï¸ CPU Cores: 3 (Multi-core)</div>
            <div class="task-container" id="container-parallel">
                <!-- JS ç”Ÿæˆä»»åŠ¡ -->
            </div>
            <div class="total-time" id="time-parallel"></div>
        </div>
    </div>

    <script>
        // --- é…ç½® ---
        const TASKS_CONFIG = [
            { name: "éŸ³ä¹æ’­æ”¾", duration: 100 },
            { name: "æ–‡ä»¶ä¸‹è½½", duration: 100 },
            { name: "æ€æ¯’æ‰«æ", duration: 100 }
        ];

        // æ¨¡æ‹Ÿé€Ÿåº¦å› å­ (è¶Šå°è¶Šå¿«)
        const SPEED_FACTOR = 40; 
        const TIME_SLICE = 800; // å¹¶å‘æ¨¡å¼ä¸‹åˆ‡æ¢æ—¶é—´ç‰‡çš„æ—¶é—´ (ms) - ä¸ºäº†çœ‹æ¸…åˆ‡æ¢ï¼Œè®¾é•¿ä¸€ç‚¹
        const CONCURRENT_WORK_PER_TICK = 2; // å¹¶å‘æ¨¡å¼æ¯å¸§å·¥ä½œé‡
        
        let timers = { serial: null, concurrent: null, parallel: null };
        let startTime = 0;

        // --- åˆå§‹åŒ– UI ---
        function initTasks(prefix) {
            const container = document.getElementById(`container-${prefix}`);
            container.innerHTML = '';
            TASKS_CONFIG.forEach((task, index) => {
                // æ ¹æ®æ¨¡å¼å†³å®š CPU æ ‡ç­¾
                let cpuLabel = "CPU";
                if (prefix === 'parallel') cpuLabel = `Core ${index + 1}`;

                const html = `
                    <div class="task-row" id="${prefix}-task-${index}">
                        <div class="task-icon">
                            ${index + 1}
                            <div class="cpu-label">${cpuLabel}</div>
                            <div class="cpu-cursor"></div>
                        </div>
                        <div class="task-info">
                            <div class="task-name">${task.name} <span class="task-status-text" id="${prefix}-status-${index}">ç­‰å¾…ä¸­</span></div>
                            <div class="progress-track">
                                <div class="progress-bar" id="${prefix}-bar-${index}" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        function resetAll() {
            Object.values(timers).forEach(t => clearInterval(t));
            timers = { serial: null, concurrent: null, parallel: null };
            
            ['serial', 'concurrent', 'parallel'].forEach(type => {
                initTasks(type);
                document.getElementById(`badge-${type}`).textContent = "IDLE";
                document.getElementById(`badge-${type}`).classList.remove('running');
                document.getElementById(`time-${type}`).textContent = "";
            });
        }

        function startAll() {
            resetAll();
            startTime = Date.now();
            
            startSerial();
            startConcurrent();
            startParallel();
        }

        // --- 1. ä¸²è¡Œé€»è¾‘ ---
        function startSerial() {
            const type = 'serial';
            markRunning(type);
            
            let currentTaskIdx = 0;
            let currentProgress = 0;
            let startT = Date.now();

            timers.serial = setInterval(() => {
                if (currentTaskIdx >= TASKS_CONFIG.length) {
                    finish(type, startT);
                    return;
                }

                // å¢åŠ è¿›åº¦
                currentProgress += 1;
                updateTaskUI(type, currentTaskIdx, currentProgress, true);

                if (currentProgress >= 100) {
                    currentProgress = 0;
                    currentTaskIdx++;
                    // å¦‚æœè¿˜æœ‰ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œé‡ç½®ä¸‹ä¸€ä¸ªä»»åŠ¡çš„UI
                    if(currentTaskIdx < TASKS_CONFIG.length) {
                        updateTaskUI(type, currentTaskIdx, 0, true);
                    }
                }
            }, SPEED_FACTOR / 2); // ä¸²è¡Œç¨å¾®å¿«ä¸€ç‚¹ä»¥ä¾¿å¯¹æ¯”
        }

        // --- 2. å¹¶å‘é€»è¾‘ (æ—¶é—´ç‰‡) ---
        function startConcurrent() {
            const type = 'concurrent';
            markRunning(type);
            
            let tasks = TASKS_CONFIG.map(() => 0); // æ‰€æœ‰ä»»åŠ¡è¿›åº¦
            let currentTaskIdx = 0;
            let startT = Date.now();
            let lastSwitchTime = Date.now();

            timers.concurrent = setInterval(() => {
                if (tasks.every(p => p >= 100)) {
                    finish(type, startT);
                    return;
                }

                // æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦
                let now = Date.now();
                if (now - lastSwitchTime > TIME_SLICE) {
                    // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæœªå®Œæˆçš„ä»»åŠ¡
                    let attempts = 0;
                    do {
                        currentTaskIdx = (currentTaskIdx + 1) % tasks.length;
                        attempts++;
                    } while (tasks[currentTaskIdx] >= 100 && attempts < tasks.length);
                    lastSwitchTime = now;
                }
                
                // å†æ¬¡æ£€æŸ¥å½“å‰ä»»åŠ¡æ˜¯å¦å·²å®Œæˆï¼ˆå¯èƒ½åœ¨æ—¶é—´ç‰‡å†…åˆšå®Œæˆï¼‰
                if (tasks[currentTaskIdx] >= 100) {
                     let attempts = 0;
                    do {
                        currentTaskIdx = (currentTaskIdx + 1) % tasks.length;
                        attempts++;
                    } while (tasks[currentTaskIdx] >= 100 && attempts < tasks.length);
                }

                // æ‰§è¡Œå½“å‰ä»»åŠ¡
                if (tasks[currentTaskIdx] < 100) {
                    tasks[currentTaskIdx] += CONCURRENT_WORK_PER_TICK; 
                    if(tasks[currentTaskIdx] > 100) tasks[currentTaskIdx] = 100;
                }

                // æ›´æ–°æ‰€æœ‰ UI
                tasks.forEach((progress, idx) => {
                    updateTaskUI(type, idx, progress, idx === currentTaskIdx && progress < 100);
                });

            }, SPEED_FACTOR);
        }

        // --- 3. å¹¶è¡Œé€»è¾‘ (å¤šæ ¸) ---
        function startParallel() {
            const type = 'parallel';
            markRunning(type);
            
            let tasks = TASKS_CONFIG.map(() => 0);
            let startT = Date.now();

            timers.parallel = setInterval(() => {
                if (tasks.every(p => p >= 100)) {
                    finish(type, startT);
                    return;
                }

                // æ‰€æœ‰æ ¸å¿ƒåŒæ—¶å·¥ä½œï¼
                tasks.forEach((p, idx) => {
                    if (p < 100) {
                        tasks[idx] += 1; // æ¯ä¸ªæ ¸å¿ƒéƒ½åœ¨è·‘
                    }
                });

                tasks.forEach((progress, idx) => {
                    updateTaskUI(type, idx, progress, progress < 100); // åªè¦æ²¡å®Œï¼Œéƒ½åœ¨è·‘
                });

            }, SPEED_FACTOR);
        }

        // --- è¾…åŠ©å‡½æ•° ---
        function markRunning(type) {
            const badge = document.getElementById(`badge-${type}`);
            badge.textContent = "RUNNING";
            badge.classList.add('running');
        }

        function finish(type, startTime) {
            clearInterval(timers[type]);
            const badge = document.getElementById(`badge-${type}`);
            badge.textContent = "DONE";
            badge.classList.remove('running');
            
            const duration = ((Date.now() - startTime) / 1000).toFixed(1);
            document.getElementById(`time-${type}`).textContent = `æ€»è€—æ—¶: ${duration}s`;
            
            // æ¸…é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
            TASKS_CONFIG.forEach((_, idx) => {
                const row = document.getElementById(`${type}-task-${idx}`);
                row.classList.remove('active');
                if(!row.classList.contains('completed')) {
                    row.classList.add('completed');
                }
            });
        }

        function updateTaskUI(prefix, index, progress, isActive) {
            const row = document.getElementById(`${prefix}-task-${index}`);
            const bar = document.getElementById(`${prefix}-bar-${index}`);
            const status = document.getElementById(`${prefix}-status-${index}`);

            bar.style.width = `${progress}%`;

            if (progress >= 100) {
                row.classList.remove('active');
                row.classList.add('completed');
                status.textContent = "å·²å®Œæˆ";
            } else {
                if (isActive) {
                    row.classList.add('active');
                    status.textContent = "CPU å¤„ç†ä¸­...";
                } else {
                    row.classList.remove('active');
                    status.textContent = progress > 0 ? "ç­‰å¾…è°ƒåº¦..." : "ç­‰å¾…ä¸­";
                }
            }
        }

        // åˆå§‹åŒ–
        resetAll();

    </script>
</body>
</html>