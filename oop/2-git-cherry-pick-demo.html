<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Cherry-pickæ¼”ç¤º</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Montserrat:wght@400;600;700&family=Georgia:wght@400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Lato', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            line-height: 1.7;
            background-color: #fdfdfd;
            color: #4a4a4a;
            display: flex;
            justify-content: center;
            padding: 20px;
        }
        .container {
            width: 100%;
            max-width: 900px;
            background-color: #ffffff;
            border-radius: 4px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.07);
            border: 1px solid #e9ecef;
            padding: 30px;
        }
        /* æ ‡é¢˜å’ŒæŒ‰é’®å®¹å™¨ */
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        h1 {
            text-align: left;
            color: #2c3e50;
            font-family: 'Georgia', 'Times New Roman', Times, serif;
            font-size: 2.8rem;
            font-weight: normal;
            position: relative;
            padding-bottom: 1rem;
            margin: 0;
            flex: 1;
        }
        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 80px;
            height: 2px;
            background-color: #af9a7d;
        }

        /* æ§åˆ¶å’ŒçŠ¶æ€åŒº */
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        button {
            padding: 10px 20px;
            border: 1px solid #2c3e50;
            border-radius: 4px;
            background-color: #2c3e50;
            color: #ffffff;
            cursor: pointer;
            font-size: 14px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        button:hover {
            background-color: #af9a7d;
            border-color: #af9a7d;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        
        button:disabled {
            background-color: #bdc3c7;
            border-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        input, select {
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
            font-family: 'Lato', sans-serif;
            background-color: #ffffff;
            color: #4a4a4a;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #af9a7d;
            box-shadow: 0 0 0 0.25rem rgba(175, 154, 125, 0.25);
        }
        
        #next-step-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #next-step-btn:hover {
            background-color: #c0392b;
        }
        #next-step-btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .status {
            background-color: #ecf0f1;
            border-left: 5px solid #e74c3c;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        #command-display {
            font-family: 'Courier New', Courier, monospace;
            background-color: #2c3e50;
            color: #f1c40f;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        #explanation {
            margin-top: 10px;
            color: #555;
        }

        /* Gitå›¾å½¢æ ·å¼ */
        .git-graph {
            background-color: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 30px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .commit {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: #2c3e50;
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #ffffff;
            box-shadow: 0 0 0 2px #2c3e50, 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .commit:hover {
            transform: scale(1.2);
            z-index: 10;
            background-color: #af9a7d;
            box-shadow: 0 0 0 2px #af9a7d, 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .commit-line {
            position: absolute;
            background-color: #bdc3c7;
            height: 3px;
            border-radius: 1.5px;
        }
        
        .branch-line {
            position: absolute;
            background-color: #2c3e50;
            width: 3px;
            border-radius: 1.5px;
        }
        
        .branch-label {
            position: absolute;
            background-color: #ffffff;
            border: 2px solid #2c3e50;
            border-radius: 4px;
            padding: 4px 12px;
            font-size: 13px;
            color: #2c3e50;
            font-weight: 600;
            font-family: 'Montserrat', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .branch-label:hover {
            background-color: #2c3e50;
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .branch-label.current-branch {
            background-color: #af9a7d;
            border-color: #af9a7d;
            color: #ffffff;
            font-weight: 700;
            box-shadow: 0 3px 8px rgba(175, 154, 125, 0.3);
        }

        /* å›¾å½¢åŒ–å±•ç¤ºåŒº */
        #graph-container {
            width: 100%;
            height: 280px;
            margin-bottom: 20px;
        }
        .commit-circle {
            transition: all 0.5s ease;
        }
        .commit-label {
            font-family: 'Courier New', Courier, monospace;
            font-size: 12px;
        }
        .main-label { background-color: #2ecc71; color: white; }
        .feature-label { background-color: #e67e22; color: white; }
        .hotfix-label { background-color: #e74c3c; color: white; }
        .head-label {
            border: 2px dashed #c0392b;
            color: #c0392b;
            padding: 1px 5px;
        }
        .cherry-pick-highlight {
            stroke: #e74c3c;
            stroke-width: 4;
            stroke-dasharray: 8,4;
            animation: cherry-pick-pulse 2s ease-in-out infinite;
        }
        .cherry-picked {
            stroke: #27ae60;
            stroke-width: 3;
            stroke-dasharray: none;
            fill: #27ae60 !important;
        }
        @keyframes cherry-pick-pulse {
            0%, 100% {
                stroke-opacity: 1;
                stroke-width: 4;
            }
            50% {
                stroke-opacity: 0.5;
                stroke-width: 6;
            }
        }

        /* é€‰æ‹©å™¨åŒºåŸŸ */
        .picker-section {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        .picker-section h3 {
            margin-top: 0;
            color: #2c3e50;
            font-family: 'Montserrat', sans-serif;
        }
        .commit-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        .commit-option {
            padding: 8px 15px;
            border: 2px solid #e9ecef;
            border-radius: 4px;
            background-color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Courier New', Courier, monospace;
            font-size: 13px;
        }
        .commit-option:hover {
            border-color: #af9a7d;
            background-color: #f8f9fa;
        }
        .commit-option.selected {
            border-color: #e74c3c;
            background-color: #e74c3c;
            color: white;
        }
        .commit-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ä»£ç æ¨¡æ‹ŸåŒº */
        .code-view {
            display: flex;
            gap: 20px;
            justify-content: space-around;
        }
        .branch-code {
            width: 48%;
        }
        .branch-code h3 {
            text-align: center;
            margin-bottom: 10px;
            color: #2c3e50;
            font-family: 'Montserrat', sans-serif;
        }
        textarea {
            width: 100%;
            height: 200px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            resize: none;
        }
        textarea:disabled {
            background-color: #f0f0f0;
            color: #888;
        }
        
        /* ä¿¡æ¯é¢æ¿ */
        #info-panel {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 20px;
            margin-top: 30px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            white-space: pre-wrap;
            color: #4a4a4a;
            line-height: 1.6;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        
        /* æ­¥éª¤è¯´æ˜ */
        .step-description {
            background-color: #ffffff;
            border-left: 4px solid #af9a7d;
            padding: 20px;
            margin: 30px 0;
            border-radius: 0 4px 4px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-top: 1px solid #e9ecef;
            border-right: 1px solid #e9ecef;
            border-bottom: 1px solid #e9ecef;
        }
        
        .step-description h3 {
            margin-top: 0;
            color: #2c3e50;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1.3rem;
        }
        
        .step-description p {
            color: #4a4a4a;
            margin-bottom: 0;
            line-height: 1.6;
        }

        /* å¯¹æ¯”åŒºåŸŸ */
        .comparison {
            display: flex;
            gap: 20px;
            margin: 30px 0;
        }
        .comparison-item {
            flex: 1;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 20px;
            background-color: #ffffff;
        }
        .comparison-item h4 {
            margin-top: 0;
            color: #2c3e50;
            text-align: center;
            font-family: 'Montserrat', sans-serif;
        }
        .before { border-left: 4px solid #e67e22; }
        .after { border-left: 4px solid #27ae60; }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .controls {
                align-self: stretch;
                justify-content: center;
            }
            
            .comparison {
                flex-direction: column;
            }
            
            .code-view {
                flex-direction: column;
            }
            
            .branch-code {
                width: 100%;
            }
            
            .commit-selector {
                justify-content: center;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-container">
        <h1>Git Cherry-pickæ¼”ç¤ºæµç¨‹</h1>
        <div class="controls">
            <button id="next-step-btn">å¼€å§‹æ¼”ç¤º</button>
        </div>
    </div>

    <div class="status">
        <pre id="command-display">ç­‰å¾…æ“ä½œ...</pre>
        <p id="explanation">ç‚¹å‡»"å¼€å§‹æ¼”ç¤º"æŒ‰é’®ï¼Œä¸€æ­¥æ­¥è·Ÿéš Git cherry-pick çš„æ“ä½œæµç¨‹ã€‚</p>
    </div>

    <div id="graph-container">
        <svg width="100%" height="100%" id="git-graph"></svg>
    </div>

    <div class="picker-section" id="picker-section" style="display: none;">
        <h3>ğŸ’ é€‰æ‹©è¦é‡‡æ‘˜çš„æäº¤</h3>
        <p>Cherry-pick å…è®¸ä½ é€‰æ‹©æ€§åœ°å°†å…¶ä»–åˆ†æ”¯çš„ç‰¹å®šæäº¤åº”ç”¨åˆ°å½“å‰åˆ†æ”¯ã€‚é€‰æ‹©ä¸€ä¸ªæäº¤è¿›è¡Œé‡‡æ‘˜ï¼š</p>
        <div class="commit-selector" id="commit-selector">
            <!-- åŠ¨æ€ç”Ÿæˆæäº¤é€‰é¡¹ -->
        </div>
        <button id="cherry-pick-btn" disabled>é‡‡æ‘˜é€‰ä¸­çš„æäº¤</button>
    </div>

    <div class="comparison" id="comparison-section" style="display: none;">
        <div class="comparison-item before">
            <h4>é‡‡æ‘˜å‰çš„æäº¤å†å²</h4>
            <div id="before-history"></div>
        </div>
        <div class="comparison-item after">
            <h4>é‡‡æ‘˜åçš„æäº¤å†å²</h4>
            <div id="after-history"></div>
        </div>
    </div>

    <div class="code-view">
        <div class="branch-code">
            <h3 id="main-code-title">main åˆ†æ”¯ (æ–‡ä»¶: project.txt)</h3>
            <textarea id="main-code" disabled></textarea>
        </div>
        <div class="branch-code">
            <h3 id="feature-code-title">feature åˆ†æ”¯ (æ–‡ä»¶: project.txt)</h3>
            <textarea id="feature-code" disabled></textarea>
        </div>
    </div>

    <div id="info-panel"></div>
</div>

<script>
    const steps = [
        {
            command: "git init",
            explanation: "åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Git ä»“åº“ã€‚æˆ‘ä»¬ä»ä¸€ä¸ªç©ºçš„ main åˆ†æ”¯å¼€å§‹ã€‚",
            action: () => {
                drawCommit('c1', 50, 'C1');
                drawBranchLabel('main', 'c1');
                drawHeadLabel('main');
                updateCode('main', 'é¡¹ç›®åˆå§‹åŒ–\nåŸºç¡€é…ç½®');
                setActiveBranch('main');
                updateInfoPanel('åˆå§‹åŒ–ä»“åº“ï¼Œåˆ›å»ºç¬¬ä¸€ä¸ªæäº¤ã€‚');
            }
        },
        {
            command: "git commit -m 'feat: æ·»åŠ ç”¨æˆ·æ¨¡å—'",
            explanation: "åœ¨ main åˆ†æ”¯ä¸Šæ·»åŠ ç”¨æˆ·æ¨¡å—åŠŸèƒ½ã€‚",
            action: () => {
                drawCommit('c2', 150, 'C2', 'c1');
                moveBranchLabel('main', 'c2');
                drawHeadLabel('main');
                updateCode('main', 'é¡¹ç›®åˆå§‹åŒ–\nåŸºç¡€é…ç½®\nç”¨æˆ·æ¨¡å—');
                updateInfoPanel('åœ¨ main åˆ†æ”¯ä¸Šæ·»åŠ ç”¨æˆ·æ¨¡å—ã€‚');
            }
        },
        {
            command: "git branch feature",
            explanation: "åŸºäºå½“å‰ main åˆ†æ”¯åˆ›å»ºä¸€ä¸ªæ–°çš„ feature åˆ†æ”¯ï¼Œç”¨äºå¼€å‘æ–°åŠŸèƒ½ã€‚",
            action: () => {
                drawBranchLabel('feature', 'c2');
                updateCode('feature', document.getElementById('main-code').value);
                updateInfoPanel('åˆ›å»º feature åˆ†æ”¯ï¼ŒåŸºäº C2 æäº¤ã€‚');
            }
        },
        {
            command: "git checkout feature",
            explanation: "åˆ‡æ¢åˆ° feature åˆ†æ”¯å¼€å§‹å¼€å‘æ–°åŠŸèƒ½ã€‚",
            action: () => {
                drawHeadLabel('feature');
                setActiveBranch('feature');
                updateInfoPanel('åˆ‡æ¢åˆ° feature åˆ†æ”¯å¼€å§‹å¼€å‘æ–°åŠŸèƒ½ã€‚');
            }
        },
        {
            command: "git commit -m 'feat: æ·»åŠ æ”¯ä»˜åŠŸèƒ½'",
            explanation: "åœ¨ feature åˆ†æ”¯ä¸Šå¼€å‘æ”¯ä»˜åŠŸèƒ½ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„æ–°åŠŸèƒ½ã€‚",
            action: () => {
                drawCommit('c3', 250, 'C3', 'c2', 'feature');
                moveBranchLabel('feature', 'c3');
                drawHeadLabel('feature');
                updateCode('feature', 'é¡¹ç›®åˆå§‹åŒ–\nåŸºç¡€é…ç½®\nç”¨æˆ·æ¨¡å—\næ”¯ä»˜åŠŸèƒ½');
                updateInfoPanel('åœ¨ feature åˆ†æ”¯ä¸Šæ·»åŠ æ”¯ä»˜åŠŸèƒ½ã€‚');
            }
        },
        {
            command: "git commit -m 'feat: ä¼˜åŒ–æ”¯ä»˜æµç¨‹'",
            explanation: "ç»§ç»­åœ¨ feature åˆ†æ”¯ä¸Šä¼˜åŒ–æ”¯ä»˜æµç¨‹ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚",
            action: () => {
                drawCommit('c4', 350, 'C4', 'c3', 'feature');
                moveBranchLabel('feature', 'c4');
                drawHeadLabel('feature');
                updateCode('feature', 'é¡¹ç›®åˆå§‹åŒ–\nåŸºç¡€é…ç½®\nç”¨æˆ·æ¨¡å—\næ”¯ä»˜åŠŸèƒ½\næ”¯ä»˜æµç¨‹ä¼˜åŒ–');
                updateInfoPanel('ç»§ç»­ä¼˜åŒ–æ”¯ä»˜æµç¨‹ã€‚');
            }
        },
        {
            command: "git commit -m 'fix: ä¿®å¤æ”¯ä»˜å®‰å…¨æ¼æ´'",
            explanation: "å‘ç°å¹¶ä¿®å¤äº†æ”¯ä»˜æ¨¡å—çš„å®‰å…¨æ¼æ´ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„å®‰å…¨ä¿®å¤ï¼",
            action: () => {
                drawCommit('c5', 450, 'C5', 'c4', 'feature');
                moveBranchLabel('feature', 'c5');
                drawHeadLabel('feature');
                updateCode('feature', 'é¡¹ç›®åˆå§‹åŒ–\nåŸºç¡€é…ç½®\nç”¨æˆ·æ¨¡å—\næ”¯ä»˜åŠŸèƒ½\næ”¯ä»˜æµç¨‹ä¼˜åŒ–\nå®‰å…¨æ¼æ´ä¿®å¤');
                updateInfoPanel('ä¿®å¤æ”¯ä»˜æ¨¡å—çš„å®‰å…¨æ¼æ´ - è¿™ä¸ªä¿®å¤å¾ˆé‡è¦ï¼');
            }
        },
        {
            command: "git checkout main",
            explanation: "åˆ‡æ¢å› main åˆ†æ”¯ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦ç´§æ€¥å°†å®‰å…¨ä¿®å¤åº”ç”¨åˆ°ä¸»åˆ†æ”¯ï¼Œä½†ä¸æƒ³è¦å…¶ä»–åŠŸèƒ½ã€‚",
            action: () => {
                drawHeadLabel('main');
                setActiveBranch('main');
                updateInfoPanel('åˆ‡æ¢å› main åˆ†æ”¯ã€‚æˆ‘ä»¬éœ€è¦ç´§æ€¥åº”ç”¨å®‰å…¨ä¿®å¤ï¼Œä½†ä¸è¦å…¶ä»–åŠŸèƒ½ã€‚');
                showPicker();
            }
        },
        {
            command: "é€‰æ‹©è¦ cherry-pick çš„æäº¤",
            explanation: "Cherry-pick å…è®¸æˆ‘ä»¬é€‰æ‹©æ€§åœ°åº”ç”¨ç‰¹å®šæäº¤ã€‚æˆ‘ä»¬åªæƒ³è¦å®‰å…¨ä¿®å¤(C5)ï¼Œè€Œä¸è¦æ”¯ä»˜åŠŸèƒ½ã€‚",
            action: () => {
                showCommitSelector();
                updateInfoPanel('é€‰æ‹©è¦é‡‡æ‘˜çš„æäº¤ã€‚æˆ‘ä»¬åªéœ€è¦å®‰å…¨ä¿®å¤ï¼Œä¸éœ€è¦æ•´ä¸ªæ”¯ä»˜åŠŸèƒ½ã€‚');
                document.getElementById('next-step-btn').style.display = 'none';
            }
        }
    ];

    const cherryPickSteps = [
        {
            command: "git cherry-pick C5",
            explanation: "å¼€å§‹ cherry-pick æ“ä½œï¼Git ä¼šå°† C5 çš„æ›´æ”¹åº”ç”¨åˆ°å½“å‰åˆ†æ”¯(main)ã€‚",
            action: () => {
                highlightCherryPickCommit('c5');
                updateInfoPanel('å¼€å§‹ cherry-pick æ“ä½œï¼šå°† C5 çš„å®‰å…¨ä¿®å¤åº”ç”¨åˆ° main åˆ†æ”¯...');
                document.getElementById('next-step-btn').innerText = "åº”ç”¨æäº¤";
                document.getElementById('next-step-btn').style.display = 'block';
            }
        },
        {
            command: "åº”ç”¨ C5' (fix: ä¿®å¤æ”¯ä»˜å®‰å…¨æ¼æ´)",
            explanation: "Git åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æäº¤ C5'ï¼ŒåŒ…å«ä¸ C5 ç›¸åŒçš„æ›´æ”¹ï¼Œä½†åŸºäº main åˆ†æ”¯çš„æœ€æ–°æäº¤ã€‚",
            action: () => {
                removeHighlight();
                drawCommit('c5p', 250, "C5'", 'c2', 'main');
                moveBranchLabel('main', 'c5p');
                drawHeadLabel('main');
                updateCode('main', 'é¡¹ç›®åˆå§‹åŒ–\nåŸºç¡€é…ç½®\nç”¨æˆ·æ¨¡å—\nå®‰å…¨æ¼æ´ä¿®å¤');
                markCommitAsCherryPicked('c5p');
                updateInfoPanel('æˆåŠŸåº”ç”¨å®‰å…¨ä¿®å¤ï¼šC5 -> C5\' (åªåŒ…å«å®‰å…¨ä¿®å¤ï¼Œä¸åŒ…å«æ”¯ä»˜åŠŸèƒ½)');
                showComparison();
                document.getElementById('next-step-btn').innerText = "å®Œæˆæ¼”ç¤º";
            }
        },
        {
            command: "Cherry-pick å®Œæˆ",
            explanation: "Cherry-pick æ“ä½œå®Œæˆï¼æˆ‘ä»¬æˆåŠŸåœ°åªé‡‡æ‘˜äº†å®‰å…¨ä¿®å¤ï¼Œè€Œæ²¡æœ‰å¼•å…¥æ•´ä¸ªæ”¯ä»˜åŠŸèƒ½ã€‚è¿™å°±æ˜¯ cherry-pick çš„å¼ºå¤§ä¹‹å¤„ã€‚",
            action: () => {
                updateAfterComparison();
                updateInfoPanel('Cherry-pick å®Œæˆï¼\n\næˆ‘ä»¬æˆåŠŸåœ°åªé‡‡æ‘˜äº†å®‰å…¨ä¿®å¤(C5\')ï¼Œè€Œæ²¡æœ‰å¼•å…¥æ”¯ä»˜åŠŸèƒ½(C3, C4)ã€‚\n\nè¿™æ · main åˆ†æ”¯å°±æœ‰äº†å®‰å…¨ä¿®å¤ï¼Œä½†ä¿æŒäº†ä»£ç çš„ç¨³å®šæ€§ã€‚');
                document.getElementById('next-step-btn').innerText = "é‡æ–°å¼€å§‹";
            }
        }
    ];

    let currentStep = -1;
    let cherryPickMode = false;
    let selectedCommit = null;
    const btn = document.getElementById('next-step-btn');
    const commandDisplay = document.getElementById('command-display');
    const explanationDisplay = document.getElementById('explanation');
    const svg = document.getElementById('git-graph');
    const infoPanel = document.getElementById('info-panel');
    const ns = "http://www.w3.org/2000/svg";

    const commitCoords = {};
    const commitData = {
        'c3': { message: 'feat: æ·»åŠ æ”¯ä»˜åŠŸèƒ½', branch: 'feature' },
        'c4': { message: 'feat: ä¼˜åŒ–æ”¯ä»˜æµç¨‹', branch: 'feature' },
        'c5': { message: 'fix: ä¿®å¤æ”¯ä»˜å®‰å…¨æ¼æ´', branch: 'feature' }
    };

    function reset() {
        currentStep = -1;
        cherryPickMode = false;
        selectedCommit = null;
        svg.innerHTML = '';
        Object.keys(commitCoords).forEach(key => delete commitCoords[key]);
        commandDisplay.innerText = "ç­‰å¾…æ“ä½œ...";
        explanationDisplay.innerText = "ç‚¹å‡»\"å¼€å§‹æ¼”ç¤º\"æŒ‰é’®ï¼Œä¸€æ­¥æ­¥è·Ÿéš Git cherry-pick çš„æ“ä½œæµç¨‹ã€‚";
        btn.innerText = "å¼€å§‹æ¼”ç¤º";
        btn.style.display = 'block';
        btn.disabled = false;
        updateCode('main', '');
        updateCode('feature', '');
        setActiveBranch(null);
        infoPanel.innerText = '';
        document.getElementById('picker-section').style.display = 'none';
        document.getElementById('comparison-section').style.display = 'none';
        document.getElementById('main-code-title').innerText = "main åˆ†æ”¯ (æ–‡ä»¶: project.txt)";
        document.getElementById('feature-code-title').innerText = "feature åˆ†æ”¯ (æ–‡ä»¶: project.txt)";
    }

    btn.addEventListener('click', () => {
        if (cherryPickMode) {
            // Cherry-pick mode steps
            currentStep++;
            if (currentStep >= cherryPickSteps.length) {
                reset();
                return;
            }

            const step = cherryPickSteps[currentStep];
            commandDisplay.innerText = step.command;
            explanationDisplay.innerText = step.explanation;
            step.action();

            if (currentStep === cherryPickSteps.length - 1) {
                btn.innerText = "é‡æ–°å¼€å§‹";
            }
        } else {
            // Normal steps
            currentStep++;
            if (currentStep >= steps.length) {
                reset();
                return;
            }

            const step = steps[currentStep];
            commandDisplay.innerText = step.command;
            explanationDisplay.innerText = step.explanation;
            step.action();

            if (currentStep === steps.length - 1) {
                // Don't show next button, wait for commit selection
            } else {
                btn.innerText = "ä¸‹ä¸€æ­¥";
            }
        }
    });

    function drawCommit(id, x, label, parentId, branch = 'main') {
        const y = branch === 'main' ? 50 : 120;
        commitCoords[id] = { x, y, branch };

        // Draw line(s) to parent(s)
        if (parentId) {
            const parents = Array.isArray(parentId) ? parentId : [parentId];
            parents.forEach(pId => {
                const pCoords = commitCoords[pId];
                const line = document.createElementNS(ns, 'line');
                line.setAttribute('id', `line-${id}-${pId}`);
                line.setAttribute('x1', pCoords.x);
                line.setAttribute('y1', pCoords.y);
                line.setAttribute('x2', x);
                line.setAttribute('y2', y);
                line.setAttribute('stroke', '#555');
                line.setAttribute('stroke-width', 2);
                svg.appendChild(line);
            });
        }
        
        // Draw circle
        const circle = document.createElementNS(ns, 'circle');
        circle.setAttribute('id', `circle-${id}`);
        circle.setAttribute('cx', x);
        circle.setAttribute('cy', y);
        circle.setAttribute('r', 15);
        circle.setAttribute('fill', branch === 'main' ? '#2ecc71' : '#e67e22');
        circle.setAttribute('stroke', '#2c3e50');
        circle.setAttribute('stroke-width', 3);
        circle.classList.add('commit-circle');
        svg.appendChild(circle);

        // Draw label
        const text = document.createElementNS(ns, 'text');
        text.setAttribute('id', `text-${id}`);
        text.setAttribute('x', x);
        text.setAttribute('y', y + 5);
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('fill', 'white');
        text.classList.add('commit-label');
        text.textContent = label;
        svg.appendChild(text);
    }

    function drawBranchLabel(branchName, commitId) {
        const coords = commitCoords[commitId];
        const foreignObject = document.createElementNS(ns, 'foreignObject');
        foreignObject.setAttribute('id', `label-${branchName}`);
        foreignObject.setAttribute('x', coords.x - 30);
        foreignObject.setAttribute('y', coords.y + 25);
        foreignObject.setAttribute('width', 70);
        foreignObject.setAttribute('height', 30);
        
        const span = document.createElement('span');
        span.className = `branch-label ${branchName}-label`;
        span.textContent = branchName;
        
        foreignObject.appendChild(span);
        svg.appendChild(foreignObject);
    }

    function moveBranchLabel(branchName, commitId) {
        const coords = commitCoords[commitId];
        const label = document.getElementById(`label-${branchName}`);
        if (label) {
            label.setAttribute('x', coords.x - 30);
            label.setAttribute('y', coords.y + 25);
        }
    }

    function drawHeadLabel(branchName) {
        // Remove existing HEAD label
        const existingHead = document.getElementById('head-label');
        if (existingHead) {
            existingHead.remove();
        }

        const branchLabel = document.getElementById(`label-${branchName}`);
        if (branchLabel) {
            const coords = {
                x: parseInt(branchLabel.getAttribute('x')) + 35,
                y: parseInt(branchLabel.getAttribute('y')) - 10
            };
            
            const foreignObject = document.createElementNS(ns, 'foreignObject');
            foreignObject.setAttribute('id', 'head-label');
            foreignObject.setAttribute('x', coords.x);
            foreignObject.setAttribute('y', coords.y);
            foreignObject.setAttribute('width', 50);
            foreignObject.setAttribute('height', 25);
            
            const span = document.createElement('span');
            span.className = 'head-label';
            span.textContent = 'HEAD';
            
            foreignObject.appendChild(span);
            svg.appendChild(foreignObject);
        }
    }

    function updateCode(branch, content) {
        document.getElementById(`${branch}-code`).value = content;
    }

    function setActiveBranch(branch) {
        // Remove active class from all branch labels
        document.querySelectorAll('.branch-label').forEach(label => {
            label.classList.remove('current-branch');
        });
        
        // Add active class to current branch
        if (branch) {
            const branchLabel = document.querySelector(`.${branch}-label`);
            if (branchLabel) {
                branchLabel.classList.add('current-branch');
            }
        }
    }

    function updateInfoPanel(text) {
        infoPanel.innerText = text;
    }

    function showPicker() {
        document.getElementById('picker-section').style.display = 'block';
    }

    function showCommitSelector() {
        const selector = document.getElementById('commit-selector');
        selector.innerHTML = '';
        
        // Add commit options
        Object.keys(commitData).forEach(commitId => {
            const data = commitData[commitId];
            const option = document.createElement('div');
            option.className = 'commit-option';
            option.setAttribute('data-commit', commitId);
            option.innerHTML = `<strong>${commitId.toUpperCase()}</strong><br>${data.message}`;
            
            option.addEventListener('click', () => {
                if (option.classList.contains('disabled')) return;
                
                // Remove previous selection
                document.querySelectorAll('.commit-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // Select this option
                option.classList.add('selected');
                selectedCommit = commitId;
                document.getElementById('cherry-pick-btn').disabled = false;
            });
            
            selector.appendChild(option);
        });
        
        // Add cherry-pick button handler
        document.getElementById('cherry-pick-btn').addEventListener('click', () => {
            if (selectedCommit) {
                startCherryPick();
            }
        });
    }

    function startCherryPick() {
        cherryPickMode = true;
        currentStep = -1;
        document.getElementById('picker-section').style.display = 'none';
        
        // Start cherry-pick steps
        btn.click();
    }

    function highlightCherryPickCommit(commitId) {
        const circle = document.getElementById(`circle-${commitId}`);
        if (circle) {
            circle.classList.add('cherry-pick-highlight');
        }
    }

    function removeHighlight() {
        document.querySelectorAll('.cherry-pick-highlight').forEach(el => {
            el.classList.remove('cherry-pick-highlight');
        });
    }

    function markCommitAsCherryPicked(commitId) {
        const circle = document.getElementById(`circle-${commitId}`);
        if (circle) {
            circle.classList.add('cherry-picked');
        }
    }

    function showComparison() {
        document.getElementById('comparison-section').style.display = 'flex';
        document.getElementById('before-history').innerHTML = `
            <div style="font-family: 'Courier New', monospace; font-size: 12px;">
                <strong>main åˆ†æ”¯:</strong><br>
                C1 â† C2 (main)<br><br>
                <strong>feature åˆ†æ”¯:</strong><br>
                C1 â† C2 â† C3 â† C4 â† C5 (feature)<br><br>
                <em>éœ€è¦ï¼šåªè¦ C5 çš„å®‰å…¨ä¿®å¤</em>
            </div>
        `;
    }

    function updateAfterComparison() {
        document.getElementById('after-history').innerHTML = `
            <div style="font-family: 'Courier New', monospace; font-size: 12px;">
                <strong>main åˆ†æ”¯:</strong><br>
                C1 â† C2 â† C5' (main) ğŸ’<br><br>
                <strong>feature åˆ†æ”¯:</strong><br>
                C1 â† C2 â† C3 â† C4 â† C5 (feature)<br><br>
                <em>ç»“æœï¼šåªé‡‡æ‘˜äº†å®‰å…¨ä¿®å¤ï¼</em>
            </div>
        `;
    }
</script>

</body>
</html>