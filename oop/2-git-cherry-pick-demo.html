<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Cherry-pick演示</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Montserrat:wght@400;600;700&family=Georgia:wght@400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Lato', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            line-height: 1.7;
            background-color: #fdfdfd;
            color: #4a4a4a;
            display: flex;
            justify-content: center;
            padding: 20px;
        }
        .container {
            width: 100%;
            max-width: 900px;
            background-color: #ffffff;
            border-radius: 4px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.07);
            border: 1px solid #e9ecef;
            padding: 30px;
        }
        /* 标题和按钮容器 */
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        h1 {
            text-align: left;
            color: #2c3e50;
            font-family: 'Georgia', 'Times New Roman', Times, serif;
            font-size: 2.8rem;
            font-weight: normal;
            position: relative;
            padding-bottom: 1rem;
            margin: 0;
            flex: 1;
        }
        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 80px;
            height: 2px;
            background-color: #af9a7d;
        }

        /* 控制和状态区 */
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        button {
            padding: 10px 20px;
            border: 1px solid #2c3e50;
            border-radius: 4px;
            background-color: #2c3e50;
            color: #ffffff;
            cursor: pointer;
            font-size: 14px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        button:hover {
            background-color: #af9a7d;
            border-color: #af9a7d;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        
        button:disabled {
            background-color: #bdc3c7;
            border-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        input, select {
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
            font-family: 'Lato', sans-serif;
            background-color: #ffffff;
            color: #4a4a4a;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #af9a7d;
            box-shadow: 0 0 0 0.25rem rgba(175, 154, 125, 0.25);
        }
        
        #next-step-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #next-step-btn:hover {
            background-color: #c0392b;
        }
        #next-step-btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .status {
            background-color: #ecf0f1;
            border-left: 5px solid #e74c3c;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        #command-display {
            font-family: 'Courier New', Courier, monospace;
            background-color: #2c3e50;
            color: #f1c40f;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        #explanation {
            margin-top: 10px;
            color: #555;
        }

        /* Git图形样式 */
        .git-graph {
            background-color: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 30px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .commit {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: #2c3e50;
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #ffffff;
            box-shadow: 0 0 0 2px #2c3e50, 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .commit:hover {
            transform: scale(1.2);
            z-index: 10;
            background-color: #af9a7d;
            box-shadow: 0 0 0 2px #af9a7d, 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .commit-line {
            position: absolute;
            background-color: #bdc3c7;
            height: 3px;
            border-radius: 1.5px;
        }
        
        .branch-line {
            position: absolute;
            background-color: #2c3e50;
            width: 3px;
            border-radius: 1.5px;
        }
        
        .branch-label {
            position: absolute;
            background-color: #ffffff;
            border: 2px solid #2c3e50;
            border-radius: 4px;
            padding: 4px 12px;
            font-size: 13px;
            color: #2c3e50;
            font-weight: 600;
            font-family: 'Montserrat', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .branch-label:hover {
            background-color: #2c3e50;
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .branch-label.current-branch {
            background-color: #af9a7d;
            border-color: #af9a7d;
            color: #ffffff;
            font-weight: 700;
            box-shadow: 0 3px 8px rgba(175, 154, 125, 0.3);
        }

        /* 图形化展示区 */
        #graph-container {
            width: 100%;
            height: 280px;
            margin-bottom: 20px;
        }
        .commit-circle {
            transition: all 0.5s ease;
        }
        .commit-label {
            font-family: 'Courier New', Courier, monospace;
            font-size: 12px;
        }
        .main-label { background-color: #2ecc71; color: white; }
        .feature-label { background-color: #e67e22; color: white; }
        .hotfix-label { background-color: #e74c3c; color: white; }
        .head-label {
            border: 2px dashed #c0392b;
            color: #c0392b;
            padding: 1px 5px;
        }
        .cherry-pick-highlight {
            stroke: #e74c3c;
            stroke-width: 4;
            stroke-dasharray: 8,4;
            animation: cherry-pick-pulse 2s ease-in-out infinite;
        }
        .cherry-picked {
            stroke: #27ae60;
            stroke-width: 3;
            stroke-dasharray: none;
            fill: #27ae60 !important;
        }
        @keyframes cherry-pick-pulse {
            0%, 100% {
                stroke-opacity: 1;
                stroke-width: 4;
            }
            50% {
                stroke-opacity: 0.5;
                stroke-width: 6;
            }
        }

        /* 选择器区域 */
        .picker-section {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        .picker-section h3 {
            margin-top: 0;
            color: #2c3e50;
            font-family: 'Montserrat', sans-serif;
        }
        .commit-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        .commit-option {
            padding: 8px 15px;
            border: 2px solid #e9ecef;
            border-radius: 4px;
            background-color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Courier New', Courier, monospace;
            font-size: 13px;
        }
        .commit-option:hover {
            border-color: #af9a7d;
            background-color: #f8f9fa;
        }
        .commit-option.selected {
            border-color: #e74c3c;
            background-color: #e74c3c;
            color: white;
        }
        .commit-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* 代码模拟区 */
        .code-view {
            display: flex;
            gap: 20px;
            justify-content: space-around;
        }
        .branch-code {
            width: 48%;
        }
        .branch-code h3 {
            text-align: center;
            margin-bottom: 10px;
            color: #2c3e50;
            font-family: 'Montserrat', sans-serif;
        }
        textarea {
            width: 100%;
            height: 200px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            resize: none;
        }
        textarea:disabled {
            background-color: #f0f0f0;
            color: #888;
        }
        
        /* 信息面板 */
        #info-panel {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 20px;
            margin-top: 30px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            white-space: pre-wrap;
            color: #4a4a4a;
            line-height: 1.6;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        
        /* 步骤说明 */
        .step-description {
            background-color: #ffffff;
            border-left: 4px solid #af9a7d;
            padding: 20px;
            margin: 30px 0;
            border-radius: 0 4px 4px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-top: 1px solid #e9ecef;
            border-right: 1px solid #e9ecef;
            border-bottom: 1px solid #e9ecef;
        }
        
        .step-description h3 {
            margin-top: 0;
            color: #2c3e50;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1.3rem;
        }
        
        .step-description p {
            color: #4a4a4a;
            margin-bottom: 0;
            line-height: 1.6;
        }

        /* 对比区域 */
        .comparison {
            display: flex;
            gap: 20px;
            margin: 30px 0;
        }
        .comparison-item {
            flex: 1;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 20px;
            background-color: #ffffff;
        }
        .comparison-item h4 {
            margin-top: 0;
            color: #2c3e50;
            text-align: center;
            font-family: 'Montserrat', sans-serif;
        }
        .before { border-left: 4px solid #e67e22; }
        .after { border-left: 4px solid #27ae60; }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .controls {
                align-self: stretch;
                justify-content: center;
            }
            
            .comparison {
                flex-direction: column;
            }
            
            .code-view {
                flex-direction: column;
            }
            
            .branch-code {
                width: 100%;
            }
            
            .commit-selector {
                justify-content: center;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-container">
        <h1>Git Cherry-pick演示流程</h1>
        <div class="controls">
            <button id="next-step-btn">开始演示</button>
        </div>
    </div>

    <div class="status">
        <pre id="command-display">等待操作...</pre>
        <p id="explanation">点击"开始演示"按钮，一步步跟随 Git cherry-pick 的操作流程。</p>
    </div>

    <div id="graph-container">
        <svg width="100%" height="100%" id="git-graph"></svg>
    </div>

    <div class="picker-section" id="picker-section" style="display: none;">
        <h3>🍒 选择要采摘的提交</h3>
        <p>Cherry-pick 允许你选择性地将其他分支的特定提交应用到当前分支。选择一个提交进行采摘：</p>
        <div class="commit-selector" id="commit-selector">
            <!-- 动态生成提交选项 -->
        </div>
        <button id="cherry-pick-btn" disabled>采摘选中的提交</button>
    </div>

    <div class="comparison" id="comparison-section" style="display: none;">
        <div class="comparison-item before">
            <h4>采摘前的提交历史</h4>
            <div id="before-history"></div>
        </div>
        <div class="comparison-item after">
            <h4>采摘后的提交历史</h4>
            <div id="after-history"></div>
        </div>
    </div>

    <div class="code-view">
        <div class="branch-code">
            <h3 id="main-code-title">main 分支 (文件: project.txt)</h3>
            <textarea id="main-code" disabled></textarea>
        </div>
        <div class="branch-code">
            <h3 id="feature-code-title">feature 分支 (文件: project.txt)</h3>
            <textarea id="feature-code" disabled></textarea>
        </div>
    </div>

    <div id="info-panel"></div>
</div>

<script>
    const steps = [
        {
            command: "git init",
            explanation: "初始化一个新的 Git 仓库。我们从一个空的 main 分支开始。",
            action: () => {
                drawCommit('c1', 50, 'C1');
                drawBranchLabel('main', 'c1');
                drawHeadLabel('main');
                updateCode('main', '项目初始化\n基础配置');
                setActiveBranch('main');
                updateInfoPanel('初始化仓库，创建第一个提交。');
            }
        },
        {
            command: "git commit -m 'feat: 添加用户模块'",
            explanation: "在 main 分支上添加用户模块功能。",
            action: () => {
                drawCommit('c2', 150, 'C2', 'c1');
                moveBranchLabel('main', 'c2');
                drawHeadLabel('main');
                updateCode('main', '项目初始化\n基础配置\n用户模块');
                updateInfoPanel('在 main 分支上添加用户模块。');
            }
        },
        {
            command: "git branch feature",
            explanation: "基于当前 main 分支创建一个新的 feature 分支，用于开发新功能。",
            action: () => {
                drawBranchLabel('feature', 'c2');
                updateCode('feature', document.getElementById('main-code').value);
                updateInfoPanel('创建 feature 分支，基于 C2 提交。');
            }
        },
        {
            command: "git checkout feature",
            explanation: "切换到 feature 分支开始开发新功能。",
            action: () => {
                drawHeadLabel('feature');
                setActiveBranch('feature');
                updateInfoPanel('切换到 feature 分支开始开发新功能。');
            }
        },
        {
            command: "git commit -m 'feat: 添加支付功能'",
            explanation: "在 feature 分支上开发支付功能。这是一个重要的新功能。",
            action: () => {
                drawCommit('c3', 250, 'C3', 'c2', 'feature');
                moveBranchLabel('feature', 'c3');
                drawHeadLabel('feature');
                updateCode('feature', '项目初始化\n基础配置\n用户模块\n支付功能');
                updateInfoPanel('在 feature 分支上添加支付功能。');
            }
        },
        {
            command: "git commit -m 'feat: 优化支付流程'",
            explanation: "继续在 feature 分支上优化支付流程，提升用户体验。",
            action: () => {
                drawCommit('c4', 350, 'C4', 'c3', 'feature');
                moveBranchLabel('feature', 'c4');
                drawHeadLabel('feature');
                updateCode('feature', '项目初始化\n基础配置\n用户模块\n支付功能\n支付流程优化');
                updateInfoPanel('继续优化支付流程。');
            }
        },
        {
            command: "git commit -m 'fix: 修复支付安全漏洞'",
            explanation: "发现并修复了支付模块的安全漏洞。这是一个重要的安全修复！",
            action: () => {
                drawCommit('c5', 450, 'C5', 'c4', 'feature');
                moveBranchLabel('feature', 'c5');
                drawHeadLabel('feature');
                updateCode('feature', '项目初始化\n基础配置\n用户模块\n支付功能\n支付流程优化\n安全漏洞修复');
                updateInfoPanel('修复支付模块的安全漏洞 - 这个修复很重要！');
            }
        },
        {
            command: "git checkout main",
            explanation: "切换回 main 分支。现在我们需要紧急将安全修复应用到主分支，但不想要其他功能。",
            action: () => {
                drawHeadLabel('main');
                setActiveBranch('main');
                updateInfoPanel('切换回 main 分支。我们需要紧急应用安全修复，但不要其他功能。');
                showPicker();
            }
        },
        {
            command: "选择要 cherry-pick 的提交",
            explanation: "Cherry-pick 允许我们选择性地应用特定提交。我们只想要安全修复(C5)，而不要支付功能。",
            action: () => {
                showCommitSelector();
                updateInfoPanel('选择要采摘的提交。我们只需要安全修复，不需要整个支付功能。');
                document.getElementById('next-step-btn').style.display = 'none';
            }
        }
    ];

    const cherryPickSteps = [
        {
            command: "git cherry-pick C5",
            explanation: "开始 cherry-pick 操作！Git 会将 C5 的更改应用到当前分支(main)。",
            action: () => {
                highlightCherryPickCommit('c5');
                updateInfoPanel('开始 cherry-pick 操作：将 C5 的安全修复应用到 main 分支...');
                document.getElementById('next-step-btn').innerText = "应用提交";
                document.getElementById('next-step-btn').style.display = 'block';
            }
        },
        {
            command: "应用 C5' (fix: 修复支付安全漏洞)",
            explanation: "Git 创建了一个新的提交 C5'，包含与 C5 相同的更改，但基于 main 分支的最新提交。",
            action: () => {
                removeHighlight();
                drawCommit('c5p', 250, "C5'", 'c2', 'main');
                moveBranchLabel('main', 'c5p');
                drawHeadLabel('main');
                updateCode('main', '项目初始化\n基础配置\n用户模块\n安全漏洞修复');
                markCommitAsCherryPicked('c5p');
                updateInfoPanel('成功应用安全修复：C5 -> C5\' (只包含安全修复，不包含支付功能)');
                showComparison();
                document.getElementById('next-step-btn').innerText = "完成演示";
            }
        },
        {
            command: "Cherry-pick 完成",
            explanation: "Cherry-pick 操作完成！我们成功地只采摘了安全修复，而没有引入整个支付功能。这就是 cherry-pick 的强大之处。",
            action: () => {
                updateAfterComparison();
                updateInfoPanel('Cherry-pick 完成！\n\n我们成功地只采摘了安全修复(C5\')，而没有引入支付功能(C3, C4)。\n\n这样 main 分支就有了安全修复，但保持了代码的稳定性。');
                document.getElementById('next-step-btn').innerText = "重新开始";
            }
        }
    ];

    let currentStep = -1;
    let cherryPickMode = false;
    let selectedCommit = null;
    const btn = document.getElementById('next-step-btn');
    const commandDisplay = document.getElementById('command-display');
    const explanationDisplay = document.getElementById('explanation');
    const svg = document.getElementById('git-graph');
    const infoPanel = document.getElementById('info-panel');
    const ns = "http://www.w3.org/2000/svg";

    const commitCoords = {};
    const commitData = {
        'c3': { message: 'feat: 添加支付功能', branch: 'feature' },
        'c4': { message: 'feat: 优化支付流程', branch: 'feature' },
        'c5': { message: 'fix: 修复支付安全漏洞', branch: 'feature' }
    };

    function reset() {
        currentStep = -1;
        cherryPickMode = false;
        selectedCommit = null;
        svg.innerHTML = '';
        Object.keys(commitCoords).forEach(key => delete commitCoords[key]);
        commandDisplay.innerText = "等待操作...";
        explanationDisplay.innerText = "点击\"开始演示\"按钮，一步步跟随 Git cherry-pick 的操作流程。";
        btn.innerText = "开始演示";
        btn.style.display = 'block';
        btn.disabled = false;
        updateCode('main', '');
        updateCode('feature', '');
        setActiveBranch(null);
        infoPanel.innerText = '';
        document.getElementById('picker-section').style.display = 'none';
        document.getElementById('comparison-section').style.display = 'none';
        document.getElementById('main-code-title').innerText = "main 分支 (文件: project.txt)";
        document.getElementById('feature-code-title').innerText = "feature 分支 (文件: project.txt)";
    }

    btn.addEventListener('click', () => {
        if (cherryPickMode) {
            // Cherry-pick mode steps
            currentStep++;
            if (currentStep >= cherryPickSteps.length) {
                reset();
                return;
            }

            const step = cherryPickSteps[currentStep];
            commandDisplay.innerText = step.command;
            explanationDisplay.innerText = step.explanation;
            step.action();

            if (currentStep === cherryPickSteps.length - 1) {
                btn.innerText = "重新开始";
            }
        } else {
            // Normal steps
            currentStep++;
            if (currentStep >= steps.length) {
                reset();
                return;
            }

            const step = steps[currentStep];
            commandDisplay.innerText = step.command;
            explanationDisplay.innerText = step.explanation;
            step.action();

            if (currentStep === steps.length - 1) {
                // Don't show next button, wait for commit selection
            } else {
                btn.innerText = "下一步";
            }
        }
    });

    function drawCommit(id, x, label, parentId, branch = 'main') {
        const y = branch === 'main' ? 50 : 120;
        commitCoords[id] = { x, y, branch };

        // Draw line(s) to parent(s)
        if (parentId) {
            const parents = Array.isArray(parentId) ? parentId : [parentId];
            parents.forEach(pId => {
                const pCoords = commitCoords[pId];
                const line = document.createElementNS(ns, 'line');
                line.setAttribute('id', `line-${id}-${pId}`);
                line.setAttribute('x1', pCoords.x);
                line.setAttribute('y1', pCoords.y);
                line.setAttribute('x2', x);
                line.setAttribute('y2', y);
                line.setAttribute('stroke', '#555');
                line.setAttribute('stroke-width', 2);
                svg.appendChild(line);
            });
        }
        
        // Draw circle
        const circle = document.createElementNS(ns, 'circle');
        circle.setAttribute('id', `circle-${id}`);
        circle.setAttribute('cx', x);
        circle.setAttribute('cy', y);
        circle.setAttribute('r', 15);
        circle.setAttribute('fill', branch === 'main' ? '#2ecc71' : '#e67e22');
        circle.setAttribute('stroke', '#2c3e50');
        circle.setAttribute('stroke-width', 3);
        circle.classList.add('commit-circle');
        svg.appendChild(circle);

        // Draw label
        const text = document.createElementNS(ns, 'text');
        text.setAttribute('id', `text-${id}`);
        text.setAttribute('x', x);
        text.setAttribute('y', y + 5);
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('fill', 'white');
        text.classList.add('commit-label');
        text.textContent = label;
        svg.appendChild(text);
    }

    function drawBranchLabel(branchName, commitId) {
        const coords = commitCoords[commitId];
        const foreignObject = document.createElementNS(ns, 'foreignObject');
        foreignObject.setAttribute('id', `label-${branchName}`);
        foreignObject.setAttribute('x', coords.x - 30);
        foreignObject.setAttribute('y', coords.y + 25);
        foreignObject.setAttribute('width', 70);
        foreignObject.setAttribute('height', 30);
        
        const span = document.createElement('span');
        span.className = `branch-label ${branchName}-label`;
        span.textContent = branchName;
        
        foreignObject.appendChild(span);
        svg.appendChild(foreignObject);
    }

    function moveBranchLabel(branchName, commitId) {
        const coords = commitCoords[commitId];
        const label = document.getElementById(`label-${branchName}`);
        if (label) {
            label.setAttribute('x', coords.x - 30);
            label.setAttribute('y', coords.y + 25);
        }
    }

    function drawHeadLabel(branchName) {
        // Remove existing HEAD label
        const existingHead = document.getElementById('head-label');
        if (existingHead) {
            existingHead.remove();
        }

        const branchLabel = document.getElementById(`label-${branchName}`);
        if (branchLabel) {
            const coords = {
                x: parseInt(branchLabel.getAttribute('x')) + 35,
                y: parseInt(branchLabel.getAttribute('y')) - 10
            };
            
            const foreignObject = document.createElementNS(ns, 'foreignObject');
            foreignObject.setAttribute('id', 'head-label');
            foreignObject.setAttribute('x', coords.x);
            foreignObject.setAttribute('y', coords.y);
            foreignObject.setAttribute('width', 50);
            foreignObject.setAttribute('height', 25);
            
            const span = document.createElement('span');
            span.className = 'head-label';
            span.textContent = 'HEAD';
            
            foreignObject.appendChild(span);
            svg.appendChild(foreignObject);
        }
    }

    function updateCode(branch, content) {
        document.getElementById(`${branch}-code`).value = content;
    }

    function setActiveBranch(branch) {
        // Remove active class from all branch labels
        document.querySelectorAll('.branch-label').forEach(label => {
            label.classList.remove('current-branch');
        });
        
        // Add active class to current branch
        if (branch) {
            const branchLabel = document.querySelector(`.${branch}-label`);
            if (branchLabel) {
                branchLabel.classList.add('current-branch');
            }
        }
    }

    function updateInfoPanel(text) {
        infoPanel.innerText = text;
    }

    function showPicker() {
        document.getElementById('picker-section').style.display = 'block';
    }

    function showCommitSelector() {
        const selector = document.getElementById('commit-selector');
        selector.innerHTML = '';
        
        // Add commit options
        Object.keys(commitData).forEach(commitId => {
            const data = commitData[commitId];
            const option = document.createElement('div');
            option.className = 'commit-option';
            option.setAttribute('data-commit', commitId);
            option.innerHTML = `<strong>${commitId.toUpperCase()}</strong><br>${data.message}`;
            
            option.addEventListener('click', () => {
                if (option.classList.contains('disabled')) return;
                
                // Remove previous selection
                document.querySelectorAll('.commit-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // Select this option
                option.classList.add('selected');
                selectedCommit = commitId;
                document.getElementById('cherry-pick-btn').disabled = false;
            });
            
            selector.appendChild(option);
        });
        
        // Add cherry-pick button handler
        document.getElementById('cherry-pick-btn').addEventListener('click', () => {
            if (selectedCommit) {
                startCherryPick();
            }
        });
    }

    function startCherryPick() {
        cherryPickMode = true;
        currentStep = -1;
        document.getElementById('picker-section').style.display = 'none';
        
        // Start cherry-pick steps
        btn.click();
    }

    function highlightCherryPickCommit(commitId) {
        const circle = document.getElementById(`circle-${commitId}`);
        if (circle) {
            circle.classList.add('cherry-pick-highlight');
        }
    }

    function removeHighlight() {
        document.querySelectorAll('.cherry-pick-highlight').forEach(el => {
            el.classList.remove('cherry-pick-highlight');
        });
    }

    function markCommitAsCherryPicked(commitId) {
        const circle = document.getElementById(`circle-${commitId}`);
        if (circle) {
            circle.classList.add('cherry-picked');
        }
    }

    function showComparison() {
        document.getElementById('comparison-section').style.display = 'flex';
        document.getElementById('before-history').innerHTML = `
            <div style="font-family: 'Courier New', monospace; font-size: 12px;">
                <strong>main 分支:</strong><br>
                C1 ← C2 (main)<br><br>
                <strong>feature 分支:</strong><br>
                C1 ← C2 ← C3 ← C4 ← C5 (feature)<br><br>
                <em>需要：只要 C5 的安全修复</em>
            </div>
        `;
    }

    function updateAfterComparison() {
        document.getElementById('after-history').innerHTML = `
            <div style="font-family: 'Courier New', monospace; font-size: 12px;">
                <strong>main 分支:</strong><br>
                C1 ← C2 ← C5' (main) 🍒<br><br>
                <strong>feature 分支:</strong><br>
                C1 ← C2 ← C3 ← C4 ← C5 (feature)<br><br>
                <em>结果：只采摘了安全修复！</em>
            </div>
        `;
    }
</script>

</body>
</html>